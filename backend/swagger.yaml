openapi: 3.0.0
info:
  title: Bardiner Travel API
  version: 1.0.0
  description: >
    Bardiner Travel REST API documentation.  
    Provides endpoints for authentication, countries, cities, posts, comments, accounts, and admin functionality.

servers:
  - url: http://localhost:5000
    description: Local Development Server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

tags:
  - name: Auth
  - name: Email
  - name: Account
  - name: Admin
  - name: Country
  - name: City
  - name: Post
  - name: Comment

paths:
  #################### AUTH ####################
  /auth/signup:
    post:
      tags: [Auth]
      summary: Register new user and send verification email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string, example: johndoe }
                email: { type: string, example: johndoe@gmail.com }
                password: { type: string, example: mysecret }
      responses:
        201:
          description: Verification email sent
        400:
          description: Invalid input or missing fields

  /auth/login:
    post:
      tags: [Auth]
      summary: Login existing user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string }
                password: { type: string }
      responses:
        200:
          description: Login successful (returns Bearer token)
        404:
          description: Invalid credentials
        409:
          description: Email not verified

  /auth/resend-verification:
    post:
      tags: [Auth]
      summary: Resend verification email for existing account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        200:
          description: Verification email resent

  /auth/forgot/password:
    post:
      tags: [Auth]
      summary: Send forgot-password email with token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string }
      responses:
        200:
          description: Forgot password email sent

  /auth/forgot-password/update:
    post:
      tags: [Auth]
      summary: Update user password using forgot-password JWT
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                password: { type: string }
      responses:
        200:
          description: Password updated successfully

  #################### EMAIL ####################
  /email/verify-email:
    get:
      tags: [Email]
      summary: Verify user email via token
      parameters:
        - name: token
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: Email verified successfully

  /email/forgot-password:
    get:
      tags: [Email]
      summary: Verify forgot-password token and return new JWT
      parameters:
        - name: token
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: JWT returned for password reset

  #################### ACCOUNT ####################
  /account:
    get:
      tags: [Account]
      summary: Get logged-in user's profile
      security:
        - bearerAuth: []
      responses:
        200:
          description: Returns user account info

  /account/update-password:
    post:
      tags: [Account]
      summary: Update password (user)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                oldPassword: { type: string }
                newPassword: { type: string }
      responses:
        200:
          description: Password updated

  /account/update-username:
    post:
      tags: [Account]
      summary: Update username (user)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string }
                password: { type: string }
      responses:
        200:
          description: Username updated

  /account/user:
    get:
      tags: [Account]
      summary: Search users (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: search
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: List of users

  /account/user/{id}:
    get:
      tags: [Account]
      summary: Get specific user account (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: Returns specific user

  /account/configure/{id}:
    patch:
      tags: [Account]
      summary: Block/unblock user (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: User blocked/unblocked

  /account/role/{id}:
    patch:
      tags: [Account]
      summary: Toggle user role (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: Role changed

  #################### ADMIN ####################
  /admin/be-admin:
    post:
      tags: [Admin]
      summary: Become admin using ADMIN_KEY
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                adminToken: { type: string }
      responses:
        200:
          description: Role changed to admin

  /admin/stats:
    get:
      tags: [Admin]
      summary: Get global system statistics
      security:
        - bearerAuth: []
      responses:
        200:
          description: Returns counts of users, admins, countries, cities

  #################### COUNTRY ####################
  /country:
    get:
      tags: [Country]
      summary: Get top countries
      responses:
        200:
          description: List of countries sorted by top

    post:
      tags: [Country]
      summary: Add new country (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name: { type: string }
                description: { type: string }
                country:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        201:
          description: Country created successfully

  /country/{id}:
    get:
      tags: [Country]
      summary: Get country by ID
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: Returns single country with cities

    patch:
      tags: [Country]
      summary: Update country (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name: { type: string }
                description: { type: string }
                country:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        200:
          description: Country updated

    delete:
      tags: [Country]
      summary: Delete country (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: Country deleted

  /country/{id}/photos:
    delete:
      tags: [Country]
      summary: Delete specific country photo (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
        - name: filename
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: Photo deleted

  /country/search:
    get:
      tags: [Country]
      summary: Search countries by name
      parameters:
        - name: name
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: Returns matching countries

  #################### CITY ####################
  /city:
    post:
      tags: [City]
      summary: Add new city (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name: { type: string }
                description: { type: string }
                countryName: { type: string }
                city:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        201:
          description: City created

  /city/all:
    get:
      tags: [City]
      summary: Get all cities (limit 50)
      responses:
        200:
          description: List of cities

  /city/search:
    get:
      tags: [City]
      summary: Search cities by name and country
      parameters:
        - name: name
          in: query
          required: true
          schema: { type: string }
        - name: country
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: Matching cities

  /city/{id}:
    get:
      tags: [City]
      summary: Get city by ID
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: Single city data

    patch:
      tags: [City]
      summary: Update city info (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name: { type: string }
                description: { type: string }
                city:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        200:
          description: City updated

    delete:
      tags: [City]
      summary: Delete city (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: City deleted

  /city/{id}/photos:
    delete:
      tags: [City]
      summary: Delete city photo (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
        - name: filename
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: Photo deleted

  #################### POST ####################
  /posts/{id}:
    post:
      tags: [Post]
      summary: Create new post in city
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
          description: City ID
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title: { type: string }
                content: { type: string }
                post:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        201:
          description: Post created

    put:
      tags: [Post]
      summary: Update post
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title: { type: string }
                content: { type: string }
                post:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        200:
          description: Post updated

    patch:
      tags: [Post]
      summary: Toggle like post
      security:
        - bearerAuth: []
      responses:
        200:
          description: Like/unlike post

    delete:
      tags: [Post]
      summary: Delete post
      security:
        - bearerAuth: []
      responses:
        200:
          description: Post deleted

  /posts/{id}/photos:
    delete:
      tags: [Post]
      summary: Delete specific post photo
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
        - name: filename
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: Image deleted

  #################### COMMENT ####################
  /comment:
    post:
      tags: [Comment]
      summary: Add comment to post
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id: { type: string, example: postId }
                content: { type: string, example: Beautiful! }
      responses:
        200:
          description: Comment added

    delete:
      tags: [Comment]
      summary: Delete comment
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: Comment deleted

  /comment/like:
    patch:
      tags: [Comment]
      summary: Like/unlike a comment
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          schema: { type: string }
      responses:
        200:
          description: Comment liked/unliked
