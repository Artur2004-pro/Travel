import { createRoot } from "react-dom/client";
import { ThemeProvider } from "./hooks/useThem";
import { RouterProvider } from "react-router-dom";
import { router } from "./route.config";
import "./index.css";

createRoot(document.getElementById("root")!).render(
  <ThemeProvider>
    <RouterProvider router={router} />
  </ThemeProvider>
);
// src/route.config.tsx
import { createBrowserRouter, Navigate } from "react-router-dom";
import { lazy, Suspense } from "react";
// Layouts
import Layout from "./pages/general/layout"; // ընդհանուր կայքի layout (header + footer)
import AdminLayout from "./pages/admin/admin-layout";
// import TripLayout from "./pages/trip/trip-layout";
import TripDashboard from "./pages/trip/trip-layout";
import Profile from "./pages/settings/profile";
// Lazy pages
const Home = lazy(() => import("./pages/general/home"));
const Login = lazy(() => import("./pages/general/login"));
const Signup = lazy(() => import("./pages/general/signup"));
const AboutPage = lazy(() => import("./pages/general/about"));
const BeAdmin = lazy(() => import("./pages/admin/be-admin"));
// Settings
const Settings = lazy(() => import("./pages/settings/setting"));
const UpdatePassword = lazy(() => import("./pages/settings/update-password"));
const UpdateUsername = lazy(() => import("./pages/settings/update-username"));
// Admin
const Admin = lazy(() => import("./pages/admin/admin"));
const Country = lazy(() => import("./pages/admin/country"));
const AddCountry = lazy(() => import("./pages/admin/add-country"));
const EditCountry = lazy(() => import("./pages/admin/edit-country"));
const City = lazy(() => import("./pages/admin/city"));
const AddCity = lazy(() => import("./pages/admin/add-city"));
const EditCity = lazy(() => import("./pages/admin/edit-city"));
const Users = lazy(() => import("./pages/admin/users"));
const EditUser = lazy(() => import("./pages/admin/edit-user"));
// Trip Wizard (միայն նոր trip ստեղծելու համար)
const Trip = lazy(() => import("./pages/trip/trip")); // wizard-ի layout (sidebar)
const TripCountry = lazy(() => import("./pages/trip/steps/country"));
const TripPlanning = lazy(() => import("./pages/trip/steps/planning"));
const TripCity = lazy(() => import("./pages/trip/steps/city"));
const SelectHotel = lazy(() => import("./pages/trip/steps/hotel"));
const DayPlanning = lazy(() => import("./pages/trip/steps/day-planning"));
const TripFinish = lazy(() => import("./pages/trip/steps/finish"));
// Trip Management (նախկին my-trips, view, edit)
const MyTrips = lazy(() => import("./pages/trip/my-trips"));
const TripView = lazy(() => import("./pages/trip/trip-view"));
const EditTrip = lazy(() => import("./pages/trip/edit-trip"));
const Loader = () => (
  <div className="min-h-screen flex items-center justify-center">
    <div className="w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin" />
  </div>
);
export const router = createBrowserRouter([
  {
    path: "/",
    element: <Layout />, // ընդհանուր layout (header + footer)
    children: [
      {
        index: true,
        element: (
          <Suspense fallback={<Loader />}>
            <Home />
          </Suspense>
        ),
      },
      {
        path: "login",
        element: (
          <Suspense fallback={<Loader />}>
            <Login />
          </Suspense>
        ),
      },
      {
        path: "signup",
        element: (
          <Suspense fallback={<Loader />}>
            <Signup />
          </Suspense>
        ),
      },
      {
        path: "about",
        element: (
          <Suspense fallback={<Loader />}>
            <AboutPage />
          </Suspense>
        ),
      },
      {
        path: "be-admin",
        element: (
          <Suspense fallback={<Loader />}>
            <BeAdmin />
          </Suspense>
        ),
      },
      // Settings
      {
        path: "settings",
        element: (
          <Suspense fallback={<Loader />}>
            <Settings />
          </Suspense>
        ),
        children: [
          { index: true, element: <Navigate to="profile" replace /> },
          {
            path: "profile",
            element: (
              <Suspense fallback={<Loader />}>
                <Profile />
              </Suspense>
            ),
          },
          {
            path: "update-password",
            element: (
              <Suspense fallback={<Loader />}>
                <UpdatePassword />
              </Suspense>
            ),
          },
          {
            path: "update-username",
            element: (
              <Suspense fallback={<Loader />}>
                <UpdateUsername />
              </Suspense>
            ),
          },
          { path: "*", element: <Navigate to="/settings/profile" replace /> },
        ],
      },

      // Admin
      {
        path: "admin",
        element: <AdminLayout />,
        children: [
          {
            index: true,
            element: (
              <Suspense fallback={<Loader />}>
                <Admin />
              </Suspense>
            ),
          },
          {
            path: "country",
            children: [
              {
                index: true,
                element: (
                  <Suspense fallback={<Loader />}>
                    <Country />
                  </Suspense>
                ),
              },
              {
                path: "add",
                element: (
                  <Suspense fallback={<Loader />}>
                    <AddCountry />
                  </Suspense>
                ),
              },
              {
                path: ":id",
                element: (
                  <Suspense fallback={<Loader />}>
                    <EditCountry />
                  </Suspense>
                ),
              },
            ],
          },
          {
            path: "city",
            children: [
              {
                index: true,
                element: (
                  <Suspense fallback={<Loader />}>
                    <City />
                  </Suspense>
                ),
              },
              {
                path: "add",
                element: (
                  <Suspense fallback={<Loader />}>
                    <AddCity />
                  </Suspense>
                ),
              },
              {
                path: "edit/:id",
                element: (
                  <Suspense fallback={<Loader />}>
                    <EditCity />
                  </Suspense>
                ),
              },
            ],
          },
          {
            path: "users",
            children: [
              {
                index: true,
                element: (
                  <Suspense fallback={<Loader />}>
                    <Users />
                  </Suspense>
                ),
              },
              {
                path: ":id",
                element: (
                  <Suspense fallback={<Loader />}>
                    <EditUser />
                  </Suspense>
                ),
              },
            ],
          },
          { path: "*", element: <Navigate to="/admin" replace /> },
        ],
      },
      // Trip Dashboard (ընդհանուր trip-ների բաժինը՝ sidebar-ով, բայց Layout-ի ներսում)
      {
        path: "trips",
        element: <TripDashboard />, // Նոր dashboard layout
        children: [
          // Default — My Trips
          { path: "", element: <MyTrips /> },
          { path: "my-trips", element: <MyTrips /> },

          // Trip View & Edit
          { path: ":id", element: <TripView /> },
          { path: "edit/:id", element: <EditTrip /> },

          // Wizard
          {
            path: "new",
            element: <Trip />, // քո հին Trip.tsx-ը (wizard-ով)
            children: [
              { path: "", element: <Navigate to="country" replace /> },
              { path: "country", element: <TripCountry /> },
              { path: "planning", element: <TripPlanning /> },
              { path: "city", element: <TripCity /> },
              { path: "hotel", element: <SelectHotel /> },
              { path: "day-planning", element: <DayPlanning /> },
              { path: "finish", element: <TripFinish /> },
              { path: "*", element: <Navigate to="country" replace /> },
            ],
          },
        ],
      },
      // Catch-all
      { path: "*", element: <Navigate to="/" replace /> },
    ],
  },
]);
export default router;
export function Footer() {
  return (
    <footer className="hidden md:block border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-black">
      <div className="max-w-5xl mx-auto px-4 py-8">
        {/* Links */}
        <div className="flex flex-wrap justify-center gap-x-4 gap-y-2 text-xs text-zinc-500">
          {["About", "Blog", "Careers", "Help", "API", "Privacy", "Terms"].map(
            (item) => (
              <a
                key={item}
                href={`#${item.toLowerCase()}`}
                className="hover:text-zinc-900 dark:hover:text-zinc-100 transition"
              >
                {item}
              </a>
            )
          )}
        </div>

        <div className="mt-4 text-center text-xs text-zinc-400">
          © {new Date().getFullYear()} Bardiner
        </div>
      </div>
    </footer>
  );
}
// src/pages/general/header.tsx
import { NavLink, useNavigate } from "react-router-dom";
import { Search, Settings } from "lucide-react";

export default function Header() {
  const navigate = useNavigate();

  return (
    <header className="sticky top-0 z-40 border-b border-zinc-200 dark:border-zinc-800 bg-white/90 dark:bg-black/90 backdrop-blur">
      <div className="max-w-5xl mx-auto px-6 h-14 flex items-center justify-between">
        <NavLink to="/" className="font-bold text-lg">
          Bardiner
        </NavLink>

        <nav className="flex gap-6 text-sm">
          <NavLink to="/" className="hover:text-black dark:hover:text-white">
            Explore
          </NavLink>
          <NavLink
            to="/trips"
            className="hover:text-black dark:hover:text-white"
          >
            Trips
          </NavLink>
        </nav>

        <div className="flex items-center gap-4">
          <Search className="w-5 h-5 cursor-pointer" />
          <Settings
            onClick={() => navigate("/settings")}
            className="w-5 h-5 cursor-pointer"
          />
        </div>
      </div>
    </header>
  );
}
import { useForm } from "react-hook-form";
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import { Loader, MessagePopup } from "../components";
import { Eye, EyeOff } from "lucide-react";
import type { ILoginResponse, IResponse } from "../../types";
import axios from "axios";

type FormValues = {
  username: string;
  email: string;
  password: string;
  code?: string;
};

export default function Signup() {
  const {
    register,
    handleSubmit,
    watch,
    formState: { errors },
  } = useForm<FormValues>();

  const navigate = useNavigate();

  const [code, setCode] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState<{
    type: "success" | "error";
    text: string;
  } | null>(null);

  const resendVerification = async () => {
    try {
      const data = watch();
      await Axios.post<IResponse>("/auth/resend-verification", data);
      setCode(true);
      setMessage({ type: "success", text: "Verification code resent" });
    } catch (err) {
      if (axios.isAxiosError(err)) {
        setMessage({
          type: "error",
          text: err.response?.data.message || "Failed to resend code",
        });
      }
    }
  };

  const onSubmit = async (data: FormValues) => {
    setLoading(true);
    try {
      if (!data.code) {
        const res = await Axios.post("auth/signup", data);
        setMessage({
          type: "success",
          text: res.data.message || "Account created",
        });
        setCode(true);
      } else {
        const res = await Axios.post<ILoginResponse>(
          "auth/verify-signup",
          data
        );
        localStorage.setItem("Authorization", res.data.payload);
        navigate("/");
      }
    } catch (err: any) {
      setMessage({
        type: "error",
        text: err?.response?.data?.message || "Signup failed",
      });
    } finally {
      setLoading(false);
    }
  };

  const input =
    "w-full h-10 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 px-3 text-sm outline-none focus:border-zinc-500";

  return (
    <div className="min-h-screen flex items-center justify-center bg-white dark:bg-black px-4">
      {loading && <Loader />}
      {message && <MessagePopup {...message} />}

      <div className="w-full max-w-sm">
        {/* Card */}
        <form
          onSubmit={handleSubmit(onSubmit)}
          className="border border-zinc-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-black px-8 py-10"
        >
          <h1 className="text-3xl font-semibold text-center mb-6 tracking-tight">
            Bardiner
          </h1>

          <p className="text-center text-sm text-zinc-500 mb-6">
            Sign up to see trips and plans
          </p>

          <div className="space-y-3">
            <input
              {...register("username", { required: true })}
              placeholder="Full name"
              className={input}
            />
            {errors.username && (
              <p className="text-xs text-red-500">Full name is required</p>
            )}

            <input
              type="email"
              {...register("email", { required: true })}
              placeholder="Email address"
              className={input}
            />
            {errors.email && (
              <p className="text-xs text-red-500">Email is required</p>
            )}

            <div className="relative">
              <input
                type={showPassword ? "text" : "password"}
                {...register("password", { required: true, minLength: 6 })}
                placeholder="Password"
                className={`${input} pr-10`}
              />
              <button
                type="button"
                onClick={() => setShowPassword((v) => !v)}
                className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600"
              >
                {showPassword ? <EyeOff size={16} /> : <Eye size={16} />}
              </button>
            </div>

            {code && (
              <input
                {...register("code")}
                placeholder="Verification code"
                className={input}
              />
            )}
          </div>

          {code && (
            <button
              type="button"
              onClick={resendVerification}
              className="mt-4 text-xs text-sky-500 hover:underline"
            >
              Resend verification code
            </button>
          )}

          <button
            type="submit"
            className="mt-5 w-full h-9 rounded-md bg-sky-500 text-white text-sm font-semibold hover:bg-sky-600"
          >
            {code ? "Verify" : "Sign up"}
          </button>

          <p className="mt-6 text-center text-xs text-zinc-500">
            By signing up, you agree to our Terms and Privacy Policy.
          </p>
        </form>

        {/* Footer */}
        <div className="mt-3 border border-zinc-300 dark:border-zinc-700 rounded-lg py-4 text-center text-sm">
          Have an account?{" "}
          <span
            onClick={() => navigate("/login")}
            className="font-semibold text-sky-500 hover:underline cursor-pointer"
          >
            Log in
          </span>
        </div>
      </div>
    </div>
  );
}
export const Cities = () => {
    return <>
    <h1>Cities</h1>
    </>
}import { useNavigate } from "react-router-dom";
import type { Country } from "../../types";
import { ImageSection } from "../components";

type Props = {
  country: Country;
};

export default function CountryFeedCard({ country }: Props) {
  const navigate = useNavigate();

  return (
    <div
      onClick={() => navigate(`/admin/country/${country._id}`)}
      className="cursor-pointer bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden hover:shadow-md transition"
    >
      {/* Image (1:1 Instagram ratio) */}
      <div className="aspect-square bg-zinc-100 dark:bg-zinc-800">
        <ImageSection images={country.images} />
      </div>

      {/* Content */}
      <div className="p-4 space-y-1">
        <h3 className="text-sm font-semibold leading-tight">{country.name}</h3>

        <p className="text-xs text-zinc-500 dark:text-zinc-400 line-clamp-2">
          {country.description}
        </p>
      </div>
    </div>
  );
}
// src/pages/general/mobile-bottom-nav.tsx
import { NavLink } from "react-router-dom";
import { Home, Search, PlusSquare, Map, User } from "lucide-react";

const items = [
  { to: "/", icon: Home },
  { to: "/trips", icon: Map },
  { to: "/trips/new", icon: PlusSquare },
  { to: "/explore", icon: Search },
  { to: "/settings", icon: User },
];

export default function MobileBottomNav() {
  return (
    <nav className="fixed bottom-0 inset-x-0 z-50 md:hidden border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-black">
      <div className="flex justify-around items-center h-14">
        {items.map(({ to, icon: Icon }) => (
          <NavLink
            key={to}
            to={to}
            className={({ isActive }) =>
              `flex items-center justify-center w-full h-full ${
                isActive ? "text-black dark:text-white" : "text-zinc-400"
              }`
            }
          >
            <Icon size={24} />
          </NavLink>
        ))}
      </div>
    </nav>
  );
}
import React from "react";

const team = [
  {
    name: "Artur",
    role: "CEO & Founder",
    avatar: "/artur.png",
  },
  {
    name: "Gurgen",
    role: "Backend Engineer",
    avatar: "/gurgen.png",
  },
  {
    name: "Arman",
    role: "Frontend Engineer",
    avatar: "/arman.png",
  },
];

export const AboutPage: React.FC = () => {
  return (
    <div className="w-full max-w-3xl mx-auto px-4 pt-8 pb-16">
      {/* Hero */}
      <section className="text-center mb-14">
        <h1 className="text-3xl sm:text-4xl font-bold tracking-tight mb-4">
          About Bardiner
        </h1>
        <p className="text-zinc-600 dark:text-zinc-400 text-base sm:text-lg">
          Bardiner is your travel companion — designed to help you explore,
          plan, and remember journeys beautifully.
        </p>
      </section>

      {/* Mission / Vision / Values */}
      <section className="space-y-10 mb-16">
        {[
          {
            title: "Mission",
            text: "To simplify travel planning and turn every journey into a memorable experience.",
          },
          {
            title: "Vision",
            text: "To become a trusted travel platform people love to use every day.",
          },
          {
            title: "Values",
            text: "Clarity, reliability, and thoughtful design in everything we build.",
          },
        ].map((item) => (
          <div
            key={item.title}
            className="border-b border-zinc-200 dark:border-zinc-800 pb-6"
          >
            <h3 className="text-lg font-semibold mb-2">{item.title}</h3>
            <p className="text-sm sm:text-base text-zinc-600 dark:text-zinc-400 leading-relaxed">
              {item.text}
            </p>
          </div>
        ))}
      </section>

      {/* Team */}
      <section>
        <h2 className="text-xl font-semibold mb-8 text-center">
          Meet the Team
        </h2>

        <div className="flex flex-col gap-8">
          {team.map((member) => (
            <div key={member.name} className="flex items-center gap-4">
              <img
                src={member.avatar}
                alt={member.name}
                className="w-14 h-14 rounded-full object-cover border border-zinc-200 dark:border-zinc-800"
              />

              <div>
                <p className="font-medium">{member.name}</p>
                <p className="text-sm text-zinc-500 dark:text-zinc-400">
                  {member.role}
                </p>
              </div>
            </div>
          ))}
        </div>
      </section>
    </div>
  );
};

export default AboutPage;
// src/pages/general/layout.tsx
import { Outlet } from "react-router-dom";
import Header from "./header";
import MobileBottomNav from "./mobile-bottom-nav";

export default function Layout() {
  return (
    <div className="min-h-screen flex flex-col bg-white dark:bg-black text-zinc-900 dark:text-zinc-100">
      {/* Desktop Header */}
      <div className="hidden md:block">
        <Header />
      </div>

      {/* Main */}
      <main className="flex-1 w-full max-w-5xl mx-auto px-0 sm:px-6 py-2 sm:py-6 pb-20 md:pb-0">
        <Outlet />
      </main>

      {/* Mobile Bottom Navigation */}
      <MobileBottomNav />
    </div>
  );
}
import { useEffect, useState } from "react";
import { Axios } from "../../lib/axios-config";
import type { Country, IResponse } from "../../types";
import { ImageSection } from "../components";
import { useNavigate } from "react-router-dom";

export const Home = () => {
  const [countries, setCountries] = useState<Country[]>([]);
  const navigate = useNavigate();

  useEffect(() => {
    Axios.get<IResponse<Country[]>>("country").then(({ data }) =>
      setCountries(data.payload.slice(0, 6))
    );
  }, []);

  return (
    <div className="flex flex-col gap-8">
      {countries.map((country) => (
        <div
          key={country._id}
          className="bg-white dark:bg-black border border-zinc-200 dark:border-zinc-800"
        >
          {/* Header */}
          <div className="px-4 py-3 font-semibold">{country.name}</div>

          {/* Image */}
          <div
            className="aspect-square cursor-pointer"
            onClick={() => navigate(`/admin/country/${country._id}`)}
          >
            <ImageSection images={country.images} />
          </div>

          {/* Description */}
          <div className="px-4 py-3 text-sm text-zinc-600 dark:text-zinc-400 line-clamp-2">
            {country.description}
          </div>
        </div>
      ))}
    </div>
  );
};

export default Home;

export const Countries = () => {
    return <>
        <h1>Countries</h1>
    </>
} import { useForm } from "react-hook-form";
import type { ILoginUser, ILoginResponse } from "../../types";
import { Axios } from "../../lib/axios-config";
import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { useNavigate } from "react-router-dom";
import { useTheme } from "../../hooks/useThem";
import axios from "axios";

export const Login = () => {
  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<ILoginUser>();

  const navigate = useNavigate();
  const { dark } = useTheme();

  const [message, setMessage] = useState("");
  const [isError, setIsError] = useState(false);
  const [loading, setLoading] = useState(false);

  const submit = async (data: ILoginUser) => {
    try {
      setLoading(true);
      const response = await Axios.post<ILoginResponse>("auth/login", data);
      localStorage.setItem("Authorization", response.data.payload);
      reset();
      setIsError(false);
      setMessage("Login successful");
      navigate("/");
    } catch (error) {
      if (axios.isAxiosError(error)) {
        setIsError(true);
        setMessage(error.response?.data?.message || "Login failed");
      }
    } finally {
      setLoading(false);
      setTimeout(() => setMessage(""), 3000);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-white dark:bg-black px-4">
      <div className="w-full max-w-sm">
        {/* Card */}
        <form
          onSubmit={handleSubmit(submit)}
          className="border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-black rounded-lg px-8 py-10"
        >
          {/* Logo / Title */}
          <h1 className="text-3xl font-semibold text-center mb-8 tracking-tight">
            Bardiner
          </h1>

          {/* Message */}
          <AnimatePresence>
            {message && (
              <motion.div
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
                className={`mb-4 text-center text-sm ${
                  isError ? "text-red-500" : "text-emerald-500"
                }`}
              >
                {message}
              </motion.div>
            )}
          </AnimatePresence>

          {/* Inputs */}
          <div className="space-y-3">
            <input
              {...register("username", { required: true })}
              placeholder="Phone number, username, or email"
              className="w-full h-10 px-3 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm outline-none focus:border-zinc-500"
            />
            <input
              {...register("password", { required: true })}
              type="password"
              placeholder="Password"
              className="w-full h-10 px-3 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm outline-none focus:border-zinc-500"
            />
          </div>

          {/* Button */}
          <button
            type="submit"
            disabled={loading}
            className="mt-5 w-full h-9 rounded-md bg-sky-500 text-white text-sm font-semibold hover:bg-sky-600 disabled:opacity-50"
          >
            {loading ? "Logging in…" : "Log in"}
          </button>

          {/* Divider */}
          <div className="flex items-center gap-4 my-6">
            <div className="flex-1 h-px bg-zinc-300 dark:bg-zinc-700" />
            <span className="text-xs text-zinc-500 font-medium">OR</span>
            <div className="flex-1 h-px bg-zinc-300 dark:bg-zinc-700" />
          </div>

          {/* Extra */}
          <p className="text-center text-sm text-zinc-600 dark:text-zinc-400">
            Forgot your password?
          </p>
        </form>

        {/* Signup */}
        <div className="mt-3 border border-zinc-300 dark:border-zinc-700 rounded-lg py-4 text-center text-sm bg-white dark:bg-black">
          Don’t have an account?{" "}
          <a
            href="/signup"
            className="font-semibold text-sky-500 hover:underline"
          >
            Sign up
          </a>
        </div>
      </div>
    </div>
  );
};

export default Login;
import { useEffect, useState } from "react";
import { useNavigate, useOutletContext } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import {
  Loader,
  MessagePopup,
  SearchInput,
  AddButton,
  BackButton,
} from "../components";
import type { IResponse, ICountry, IShowMessage, IAccount } from "../../types";
import { CountryItem } from "./country-item";

export default function Country() {
  const account = useOutletContext<IAccount>();
  const [countries, setCountries] = useState<ICountry[]>([]);
  const [search, setSearch] = useState("");
  const [loading, setLoading] = useState(true);
  const [message, setMessage] = useState<IShowMessage | null>(null);
  const navigate = useNavigate();

  const showMessage = (type: "success" | "error", text: string) => {
    setMessage({ type, text });
    setTimeout(() => setMessage(null), 3000);
  };

  useEffect(() => {
    handleGetCountries();
  }, []);

  const handleGetCountries = async () => {
    try {
      const { data } = await Axios.get<IResponse<ICountry[]>>("country");
      setCountries(data.payload);
    } catch {
      showMessage("error", "❌ Failed to load countries");
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id: string) => {
    try {
      await Axios.delete(`country/${id}`);
      setCountries((prev) => prev.filter((c) => c._id !== id));
      showMessage("success", "✅ Country deleted");
    } catch {
      showMessage("error", "❌ Failed to delete");
    }
  };

  if (loading) return <Loader />;
  if (!account || account.role !== "admin")
    return (
      <div className="p-10 text-center text-zinc-500">❌ Not authorized</div>
    );

  const filtered = countries.filter((c) =>
    c.name.toLowerCase().includes(search.toLowerCase())
  );

  return (
    <div className="animate-fade-in space-y-6 px-4 sm:px-6 md:px-8">
      {message && <MessagePopup {...message} />}

      {/* Top Controls */}
      <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-4">
        <SearchInput
          value={search}
          onChange={setSearch}
          placeholder="Search country..."
          className="flex-1"
        />
        <div className="flex gap-2">
          <AddButton
            onClick={() => navigate("/admin/add-country")}
            label="Add Country"
          />
          <BackButton />
        </div>
      </div>

      {/* Country Feed */}
      {filtered.length === 0 ? (
        <div className="text-center text-zinc-500 mt-10">
          No countries found. Add new countries to get started.
        </div>
      ) : (
        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          {filtered.map((country) => (
            <CountryItem
              key={country._id}
              country={country}
              onDelete={handleDelete}
            />
          ))}
        </div>
      )}
    </div>
  );
}
import { useEffect, useState } from "react";
import { Outlet, useNavigate } from "react-router-dom";
import { Menu, X, ChevronRight, ChevronLeft, LogOut } from "lucide-react";
import type { IAccount, IResponse } from "../../types";
import { Axios } from "../../lib/axios-config";
import { EmptyState, navItems, SidebarLink } from "../components";

export default function AdminLayout() {
  const [open, setOpen] = useState(true);
  const [mobile, setMobile] = useState(false);
  const [account, setAccount] = useState<IAccount | null>(null);
  const navigate = useNavigate();

  useEffect(() => {
    handleGetAccount();
  }, []);

  const toggleSidebar = () => setOpen((v) => !v);

  const signOut = () => {
    localStorage.removeItem("Authorization");
    navigate("/");
  };

  const handleGetAccount = async () => {
    try {
      const { data } = await Axios.get<IResponse<IAccount>>("account/");
      setAccount(data.payload);
    } catch {
      setAccount(null);
    }
  };

  if (!account || account.role !== "admin") {
    return (
      <EmptyState title="Cannot access" icon="❌" subtitle="You not admin" />
    );
  }

  return (
    <div className="min-h-screen flex bg-gray-50 dark:bg-slate-900">
      {/* BACKGROUND */}
      <div className="fixed inset-0 -z-10 pointer-events-none">
        <div className="absolute inset-0 bg-gradient-to-br from-pink-50 via-white to-teal-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950" />
        <div className="absolute -top-32 left-1/2 -translate-x-1/2 w-[46rem] h-[26rem] rounded-full blur-3xl opacity-30 bg-gradient-to-r from-pink-400 via-purple-400 to-teal-400 animate-pulse-slow" />
      </div>

      {/* DESKTOP SIDEBAR */}
      <aside
        className={`hidden md:flex flex-col transition-all duration-300 m-3 rounded-3xl glass border border-zinc-200/30 dark:border-slate-800/30 ${
          open ? "w-72" : "w-20"
        }`}
      >
        {/* Brand */}
        <div className="flex items-center justify-between p-4">
          <div className="flex items-center gap-3">
            <span className="inline-flex h-10 w-10 items-center justify-center rounded-2xl shadow-md bg-gradient-to-tr from-pink-400 to-teal-400">
              <img src="/logo1.png" alt="Bardiner" className="h-6 w-6" />
            </span>
            {open && (
              <div className="flex flex-col">
                <span className="font-semibold text-base text-gray-800 dark:text-gray-100">
                  Bardiner Admin
                </span>
                <span className="text-xs text-gray-500 dark:text-gray-400">
                  Dashboard
                </span>
              </div>
            )}
          </div>
          <button
            onClick={toggleSidebar}
            aria-label="Toggle sidebar"
            className="h-9 w-9 rounded-xl border border-zinc-200 dark:border-slate-700 hover:bg-gray-100/60 dark:hover:bg-slate-800/50 flex items-center justify-center"
          >
            {open ? (
              <ChevronLeft className="w-4 h-4" />
            ) : (
              <ChevronRight className="w-4 h-4" />
            )}
          </button>
        </div>

        {/* Nav */}
        <nav className="mt-4 px-3 flex-1 space-y-2 overflow-y-auto">
          {navItems.map((item) => (
            <SidebarLink key={item.label} item={item} />
          ))}
        </nav>

        {/* Footer */}
        <div className="p-3 border-t border-zinc-200/20 dark:border-slate-800/20">
          <button
            onClick={signOut}
            className="w-full flex items-center justify-center gap-2 btn-surface rounded-xl py-2 hover:bg-gray-100/50 dark:hover:bg-slate-800/50 transition"
          >
            <LogOut className="h-4 w-4" />
            {open && <span>Sign out</span>}
          </button>
        </div>
      </aside>

      {/* MOBILE DRAWER */}
      {mobile && (
        <div className="fixed inset-0 z-50 md:hidden">
          <div
            className="absolute inset-0 bg-black/40 backdrop-blur-sm"
            onClick={() => setMobile(false)}
          />
          <aside className="absolute left-0 top-0 h-full w-72 p-4 glass rounded-r-3xl border-r border-zinc-200/20 dark:border-slate-800/20 shadow-lg">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-2">
                <span className="inline-flex h-10 w-10 items-center justify-center rounded-2xl bg-gradient-to-tr from-pink-400 to-teal-400 shadow-md">
                  <img src="/logo1.png" alt="Bardiner" className="h-6 w-6" />
                </span>
                <span className="font-semibold text-base text-gray-800 dark:text-gray-100">
                  Bardiner Admin
                </span>
              </div>
              <button
                onClick={() => setMobile(false)}
                aria-label="Close menu"
                className="h-9 w-9 flex items-center justify-center rounded-xl border border-zinc-200 dark:border-slate-700 hover:bg-gray-100/60 dark:hover:bg-slate-800/50"
              >
                <X className="h-5 w-5" />
              </button>
            </div>

            <nav className="flex flex-col gap-2">
              {navItems.map((item) => (
                <SidebarLink
                  key={item.label}
                  item={item}
                  onClick={() => setMobile(false)}
                />
              ))}
            </nav>

            <div className="mt-6 border-t border-zinc-200/20 dark:border-slate-800/20 pt-3">
              <button
                onClick={signOut}
                className="w-full flex items-center justify-center gap-2 btn-surface rounded-xl py-2 hover:bg-gray-100/50 dark:hover:bg-slate-800/50 transition"
              >
                <LogOut className="h-4 w-4" />
                <span>Sign out</span>
              </button>
            </div>
          </aside>
        </div>
      )}

      {/* MAIN CONTENT */}
      <div className="flex-1 flex flex-col">
        <div className="flex items-center justify-between p-4 md:hidden">
          <button
            onClick={() => setMobile(true)}
            className="h-9 w-9 flex items-center justify-center rounded-xl border border-zinc-200 dark:border-slate-700 hover:bg-gray-100/60 dark:hover:bg-slate-800/50"
            aria-label="Open menu"
          >
            <Menu className="h-5 w-5" />
          </button>
        </div>
        <div className="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">
          <Outlet context={account} />
        </div>
      </div>
    </div>
  );
}
import type { ICountryProps } from "../../types";
import { EditButton, DeleteButton, ImageSection } from "../components";

export const CountryItem = ({ country, onDelete }: ICountryProps) => {
  return (
    <div className="group relative overflow-hidden rounded-2xl border border-zinc-200/20 dark:border-slate-700/20 bg-white dark:bg-slate-900 shadow-sm hover:shadow-md transition-all duration-300">
      {/* Cover */}
      <div className="relative w-full h-64 sm:h-72 md:h-64">
        {country.images?.length ? (
          <ImageSection images={country.images} />
        ) : (
          <div className="w-full h-full bg-gradient-to-br from-sky-200/30 to-teal-200/20 dark:from-slate-800 dark:to-slate-900" />
        )}
        <div className="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent" />
        <h3 className="absolute bottom-3 left-3 text-lg sm:text-xl font-semibold text-white drop-shadow-md">
          {country.name}
        </h3>
      </div>

      {/* Description */}
      <div className="p-3 sm:p-4 flex flex-col justify-between space-y-2 sm:space-y-3">
        <p className="text-sm sm:text-base line-clamp-2 text-zinc-700 dark:text-zinc-300">
          {country.description || "No description provided."}
        </p>

        {/* Actions */}
        <div className="flex justify-end gap-2 mt-2">
          <EditButton to={`/admin/country/${country._id}`} small />
          <DeleteButton id={country._id} onClick={() => onDelete(country._id)} small />
        </div>
      </div>
    </div>
  );
};
import { EditButton } from "../components";
import { UserCircle2 } from "lucide-react";
import type { IAccountProps } from "../../types";

export const UserItem = ({ account }: IAccountProps) => {
  return (
    <div className="flex flex-col items-center text-center rounded-2xl border border-slate-800/30 bg-gradient-to-br from-slate-900/80 via-slate-900/60 to-slate-950/80 shadow-md hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 p-5 hover:border-sky-400/30 w-full max-w-xs mx-auto">
      {/* Avatar */}
      {account.avatar ? (
        <img
          src={account.avatar}
          alt={account.username}
          className="h-20 w-20 rounded-full object-cover shadow-lg ring-2 ring-sky-500/30 mb-3"
        />
      ) : (
        <div className="h-20 w-20 rounded-full bg-gradient-to-br from-sky-500/30 to-teal-400/30 flex items-center justify-center mb-3 ring-2 ring-sky-400/20">
          <UserCircle2 className="h-10 w-10 text-sky-400" />
        </div>
      )}

      {/* Info */}
      <div className="space-y-0.5">
        <h3 className="font-semibold text-zinc-100 text-base truncate max-w-[180px]">
          {account.username}
        </h3>
        <p className="text-xs text-zinc-400 truncate max-w-[200px]">
          {account.email}
        </p>
      </div>

      {/* Role & Status */}
      <div className="flex flex-wrap justify-center gap-2 mt-3 text-xs font-medium">
        <span
          className={`px-3 py-1 rounded-lg ${
            account.role === "admin"
              ? "bg-emerald-500/20 text-emerald-400 border border-emerald-400/30"
              : "bg-sky-500/20 text-sky-400 border border-sky-400/30"
          }`}
        >
          {account.role}
        </span>
        <span
          className={`px-3 py-1 rounded-lg ${
            account.isBlocked
              ? "bg-rose-500/20 text-rose-400 border border-rose-400/30"
              : "bg-emerald-500/20 text-emerald-400 border border-emerald-400/30"
          }`}
        >
          {account.isBlocked ? "Blocked" : "Active"}
        </span>
      </div>

      {/* Actions */}
      <div className="flex justify-center mt-5 w-full">
        <EditButton to={`/admin/users/${account._id}`} />
      </div>
    </div>
  );
};
import { useState } from "react";
import { Axios } from "../../lib/axios-config";
import { Loader, MessagePopup, BackButton } from "../components";
import type { IShowMessage } from "../../types";

export const BeAdmin = () => {
  const [email, setEmail] = useState("");
  const [reason, setReason] = useState("");
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState<IShowMessage | null>(null);

  const showMessage = (type: "success" | "error", text: string) => {
    setMessage({ type, text });
    setTimeout(() => setMessage(null), 3000);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    try {
      const { data } = await Axios.post("/be-admin", { email, reason });
      showMessage("success", data.message || "✅ Request sent successfully!");
      setEmail("");
      setReason("");
    } catch (err: any) {
      showMessage(
        "error",
        err?.response?.data?.message || "❌ Failed to send admin request."
      );
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="bg-app min-h-screen flex justify-center items-center py-10 px-4">
      {loading && <Loader />}
      {message && <MessagePopup {...message} />}

      <form
        onSubmit={handleSubmit}
        className="glass w-full max-w-md p-8 rounded-3xl shadow-xl space-y-6 animate-fade-in"
      >
        <h2 className="text-3xl font-extrabold text-center bg-clip-text text-transparent bg-gradient-to-r from-sky-500 via-teal-400 to-emerald-400">
          Become an Admin ✨
        </h2>

        <p className="text-sm text-center text-zinc-500 dark:text-zinc-400 mb-4">
          Submit a request to get admin access for managing platform data.
        </p>

        <div>
          <label className="text-sm font-medium text-zinc-700 dark:text-zinc-300">
            Your Email
          </label>
          <input
            type="email"
            className="input mt-1"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="you@example.com"
            required
          />
        </div>

        <div>
          <label className="text-sm font-medium text-zinc-700 dark:text-zinc-300">
            Why do you need admin access?
          </label>
          <textarea
            className="input h-28 mt-1"
            value={reason}
            onChange={(e) => setReason(e.target.value)}
            placeholder="Explain briefly your reason..."
            required
          />
        </div>

        <button
          type="submit"
          className="btn-primary w-full justify-center mt-2"
        >
          Submit Request
        </button>

        <div className="flex justify-center mt-4">
          <BackButton />
        </div>
      </form>
    </div>
  );
};

export default BeAdmin;
import { useEffect, useState, useMemo } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import {
  Loader,
  MessagePopup,
  BackButton,
  UploadImages,
  ImageCarousel,
} from "../components";
import type { ICountry, IResponse, IShowMessage } from "../../types";
import { useForm } from "react-hook-form";

export const EditCountry = () => {
  const { id } = useParams();
  const navigate = useNavigate();

  const [country, setCountry] = useState<ICountry | null>(null);
  const [message, setMessage] = useState<IShowMessage | null>(null);
  const [loading, setLoading] = useState(false);

  const [files, setFiles] = useState<File[]>([]);
  const [previews, setPreviews] = useState<string[]>([]);
  const [imagesChanged, setImagesChanged] = useState(false);

  const { register, handleSubmit, reset, formState } = useForm<ICountry>();

  useEffect(() => {
    if (id) fetchCountry();
  }, [id]);

  const fetchCountry = async () => {
    try {
      setLoading(true);
      const { data } = await Axios.get<IResponse<ICountry>>(`/country/${id}`);
      setCountry(data.payload);
      reset(data.payload);
      setFiles([]);
      setPreviews([]);
      setImagesChanged(false);
    } catch {
      setMessage({ type: "error", text: "Failed to load country data." });
    } finally {
      setLoading(false);
    }
  };

  const onSubmit = async (data: ICountry) => {
    if (!canSave) return;
    try {
      const formData = new FormData();
      formData.append("name", data.name);
      formData.append("description", data.description);
      files.forEach((f) => formData.append("country", f));
      await Axios.patch(`/country/${id}`, formData, {
        headers: { "Content-Type": "multipart/form-data" },
      });
      setMessage({ type: "success", text: "Country updated successfully!" });
      setFiles([]);
      setPreviews([]);
      setImagesChanged(false);
      setTimeout(() => navigate("/admin/country"), 1100);
    } catch {
      setMessage({ type: "error", text: "Update failed." });
    }
  };

  const handleUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (!e.target.files) return;
    const imgs = Array.from(e.target.files);
    setFiles((prev) => [...prev, ...imgs]);
    setPreviews((prev) => [
      ...prev,
      ...imgs.map((i) => URL.createObjectURL(i)),
    ]);
  };
  const handleDeleteNew = (i: number) => {
    setFiles((prev) => prev.filter((_, x) => x !== i));
    setPreviews((prev) => prev.filter((_, x) => x !== i));
  };
  const handleDeleteOldImage = async (filename: string) => {
    try {
      await Axios.delete(`/country/${id}/photos?filename=${filename}`);
      if (country) {
        setCountry({
          ...country,
          images: country.images.filter((img) => img !== filename),
        });
      }
      setImagesChanged(true);
    } catch {
      setMessage({ type: "error", text: "Failed to delete image." });
    }
  };

  const canSave = useMemo(() => {
    return formState.isDirty || files.length > 0 || imagesChanged;
  }, [formState.isDirty, files.length, imagesChanged]);

  if (loading || !country) return <Loader />;

  return (
    <div className="flex flex-col items-center py-4 px-2 min-h-screen bg-gray-50 dark:bg-[#0f1624]">
      <div className="w-full max-w-xl bg-white dark:bg-[#1a1f2b] rounded-2xl shadow-lg p-6 space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <h1 className="text-2xl font-bold text-gray-900 dark:text-white">
            Edit Country ✏️
          </h1>
          <BackButton to="/admin/country" />
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <input
            {...register("name", { required: "Country name is required" })}
            placeholder="Country Name"
            className="w-full p-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-[#0f1624]/70 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-teal-400 focus:border-transparent outline-none"
          />
          {formState.errors.name && (
            <p className="text-sm text-red-500">
              {formState.errors.name.message}
            </p>
          )}

          <textarea
            {...register("description")}
            placeholder="Country description..."
            rows={4}
            className="w-full p-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-[#0f1624]/70 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-teal-400 focus:border-transparent outline-none"
          />

          {/* Image Carousel */}
          <ImageCarousel
            isAdmin
            images={country.images}
            onDeleteImage={handleDeleteOldImage}
            className="rounded-xl overflow-hidden"
          />

          {/* Upload */}
          <UploadImages
            label="Upload New Images"
            previews={previews}
            onAdd={handleUpload}
            onDelete={handleDeleteNew}
          />

          <button
            type="submit"
            disabled={!canSave}
            className={`w-full py-3 rounded-xl font-semibold text-white ${
              canSave
                ? "bg-gradient-to-r from-sky-500 via-teal-400 to-emerald-500 hover:brightness-105"
                : "bg-gray-400 cursor-not-allowed"
            }`}
          >
            Save Changes
          </button>
        </form>

        {message && <MessagePopup type={message.type} text={message.text} />}
      </div>
    </div>
  );
};

export default EditCountry;
import { useEffect, useState } from "react";
import { useNavigate, useOutletContext } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import {
  Loader,
  MessagePopup,
  SearchInput,
  AddButton,
  BackButton,
} from "../components";
import type { IResponse, ICity, IShowMessage, IAccount } from "../../types";
import { useDebounce } from "../../hooks/useDebounce";
import { CityItem } from "./city-item";

export const City = () => {
  const account = useOutletContext<IAccount>();
  const [cities, setCities] = useState<ICity[]>([]);
  const [search, setSearch] = useState("");
  const debouncedSearch = useDebounce(search, 500);
  const [loading, setLoading] = useState(true);
  const [message, setMessage] = useState<IShowMessage | null>(null);
  const navigate = useNavigate();

  const showMessage = (type: "success" | "error", text: string) => {
    setMessage({ type, text });
    setTimeout(() => setMessage(null), 3000);
  };

  useEffect(() => {
    if (debouncedSearch.trim()) handleSearch(debouncedSearch);
    else handleGetAllCities();
  }, [debouncedSearch]);

  const handleGetAllCities = async () => {
    try {
      setLoading(true);
      const { data } = await Axios.get<IResponse<ICity[]>>("city/top");
      setCities(data.payload);
    } catch {
      showMessage("error", "Failed to load cities");
    } finally {
      setLoading(false);
    }
  };

  const handleSearch = async (query: string) => {
    try {
      setLoading(true);
      const { data } = await Axios.get<IResponse<ICity[]>>(
        `city/search?name=${query}`
      );
      setCities(data.payload);
    } catch {
      showMessage("error", "❌ Failed to search cities");
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id: string) => {
    try {
      await Axios.delete(`city/${id}`);
      setCities((prev) => prev.filter((c) => c._id !== id));
      showMessage("success", "✅ City deleted");
    } catch {
      showMessage("error", "❌ Failed to delete");
    }
  };

  if (loading) return <Loader />;
  if (!account || account.role !== "admin")
    return (
      <div className="p-10 text-center text-zinc-500">❌ Not authorized</div>
    );

  const filtered = cities.filter((c) =>
    c.name.toLowerCase().includes(search.toLowerCase())
  );

  return (
    <div className="animate-fade-in space-y-6 px-4 sm:px-6 md:px-8">
      {message && <MessagePopup {...message} />}

      {/* Top Controls */}
      <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <SearchInput
          value={search}
          onChange={setSearch}
          placeholder="Search city..."
          className="flex-1"
        />
        <div className="flex gap-2">
          <AddButton
            onClick={() => navigate(`/admin/city/add`)}
            label="Add City"
          />
          <BackButton />
        </div>
      </div>

      {/* City Feed */}
      {filtered.length === 0 ? (
        <div className="text-center text-zinc-500 mt-10">
          No cities found. Add new cities to get started.
        </div>
      ) : (
        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          {filtered.map((city) => (
            <CityItem key={city._id} city={city} onDelete={handleDelete} />
          ))}
        </div>
      )}
    </div>
  );
};

export default City;
import { useEffect, useState, useMemo } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import {
  Loader,
  MessagePopup,
  BackButton,
  UploadImages,
  ImageCarousel,
} from "../components";
import type { ICity, IResponse, IShowMessage } from "../../types";
import { useForm } from "react-hook-form";

export const EditCity = () => {
  const { id } = useParams();
  const navigate = useNavigate();

  const [city, setCity] = useState<ICity | null>(null);
  const [message, setMessage] = useState<IShowMessage | null>(null);
  const [loading, setLoading] = useState(false);

  const [files, setFiles] = useState<File[]>([]);
  const [previews, setPreviews] = useState<string[]>([]);
  const [imagesChanged, setImagesChanged] = useState(false);

  const { register, handleSubmit, reset, formState } = useForm<ICity>();

  useEffect(() => {
    if (id) fetchCity();
  }, [id]);

  const fetchCity = async () => {
    try {
      setLoading(true);
      const { data } = await Axios.get<IResponse<ICity>>(`/city/${id}`);
      setCity(data.payload);
      reset(data.payload);
      setFiles([]);
      setPreviews([]);
      setImagesChanged(false);
    } catch {
      setMessage({ type: "error", text: "Failed to load city data." });
    } finally {
      setLoading(false);
    }
  };

  const onSubmit = async (data: ICity) => {
    if (!canSave) return;
    try {
      const formData = new FormData();
      formData.append("name", data.name);
      formData.append("description", data.description);
      files.forEach((f) => formData.append("city", f));
      await Axios.patch(`/city/${id}`, formData, {
        headers: { "Content-Type": "multipart/form-data" },
      });
      setMessage({ type: "success", text: "City updated successfully!" });
      setFiles([]);
      setPreviews([]);
      setImagesChanged(false);
      setTimeout(() => navigate("/admin/city"), 1100);
    } catch {
      setMessage({ type: "error", text: "Update failed." });
    }
  };

  const handleUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (!e.target.files) return;
    const imgs = Array.from(e.target.files);
    setFiles((prev) => [...prev, ...imgs]);
    setPreviews((prev) => [
      ...prev,
      ...imgs.map((i) => URL.createObjectURL(i)),
    ]);
  };
  const handleDeleteNew = (i: number) => {
    setFiles((prev) => prev.filter((_, x) => x !== i));
    setPreviews((prev) => prev.filter((_, x) => x !== i));
  };
  const handleDeleteOldImage = async (filename: string) => {
    try {
      await Axios.delete(`/city/${id}/photos?filename=${filename}`);
      if (city) {
        setCity({
          ...city,
          images: city.images.filter((img) => img !== filename),
        });
      }
      setImagesChanged(true);
    } catch {
      setMessage({ type: "error", text: "Failed to delete image." });
    }
  };

  const canSave = useMemo(() => {
    return formState.isDirty || files.length > 0 || imagesChanged;
  }, [formState.isDirty, files.length, imagesChanged]);

  if (loading || !city) return <Loader />;

  return (
    <div className="flex flex-col items-center py-4 px-2 min-h-screen bg-gray-50 dark:bg-[#0f1624]">
      <div className="w-full max-w-xl bg-white dark:bg-[#1a1f2b] rounded-2xl shadow-lg p-6 space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <h1 className="text-2xl font-bold text-gray-900 dark:text-white">
            Edit City ✏️
          </h1>
          <BackButton to="/admin/city" />
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <input
            {...register("name", { required: "City name is required" })}
            placeholder="City Name"
            className="w-full p-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-[#0f1624]/70 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-teal-400 focus:border-transparent outline-none"
          />
          {formState.errors.name && (
            <p className="text-sm text-red-500">
              {formState.errors.name.message}
            </p>
          )}

          <textarea
            {...register("description")}
            placeholder="City description..."
            rows={4}
            className="w-full p-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-[#0f1624]/70 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-teal-400 focus:border-transparent outline-none"
          />

          {/* Image Carousel */}
          <ImageCarousel
            isAdmin
            images={city.images}
            onDeleteImage={handleDeleteOldImage}
            className="rounded-xl overflow-hidden"
          />

          {/* Upload */}
          <UploadImages
            label="Upload New Images"
            previews={previews}
            onAdd={handleUpload}
            onDelete={handleDeleteNew}
          />

          <button
            type="submit"
            disabled={!canSave}
            className={`w-full py-3 rounded-xl font-semibold text-white ${
              canSave
                ? "bg-gradient-to-r from-sky-500 via-teal-400 to-emerald-500 hover:brightness-105"
                : "bg-gray-400 cursor-not-allowed"
            }`}
          >
            Save Changes
          </button>
        </form>

        {message && <MessagePopup type={message.type} text={message.text} />}
      </div>
    </div>
  );
};

export default EditCity;
import { useEffect, useState } from "react";
import { Axios } from "../../lib/axios-config";
import {
  AdminCard,
  Loader,
  MessagePopup,
  EmptyState,
  SearchInput,
} from "../components";
import type { IAccount, IResponse, IShowMessage } from "../../types";
import { UserItem } from "./user-item";
import { useOutletContext } from "react-router-dom";

export const Users = () => {
  const account = useOutletContext<IAccount>();
  const [users, setUsers] = useState<IAccount[]>([]);
  const [search, setSearch] = useState("");
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState<IShowMessage | null>(null);

  const showMessage = (type: "success" | "error", text: string) => {
    setMessage({ type, text });
    setTimeout(() => setMessage(null), 3000);
  };

  useEffect(() => {
    if (!search.trim()) return;
    handleGetUsers();
  }, [search]);

  const handleGetUsers = async () => {
    try {
      setLoading(true);
      const { data } = await Axios.get<IResponse<IAccount[]>>(
        `account/user?search=${search}`
      );
      setUsers(data.payload);
    } catch {
      showMessage("error", "❌ Failed to load users");
    } finally {
      setLoading(false);
    }
  };

  const filtered = users.filter((u) =>
    `${u.username} ${u.email}`.toLowerCase().includes(search.toLowerCase())
  );

  if (loading) return <Loader />;
  if (!account || account.role !== "admin") {
    return (
      <EmptyState title="No access" subtitle="You are not an admin" icon="❌" />
    );
  }

  return (
    <div className="px-4 py-6 sm:px-6 lg:px-8">
      {message && <MessagePopup {...message} />}

      <AdminCard title="User Management" icon="👥">
        {/* 🔍 Search bar */}
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
          <SearchInput
            value={search}
            onChange={setSearch}
            placeholder="Search users..."
            className="w-full sm:max-w-sm rounded-xl shadow-inner border border-gray-300 dark:border-gray-700"
          />
        </div>

        {/* 🚫 Empty or grid */}
        {filtered.length === 0 ? (
          <EmptyState
            title="No users found"
            subtitle="Try adjusting your search or add new users manually."
          />
        ) : (
          <div className="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            {filtered.map((user) => (
              <UserItem key={user._id} account={user} />
            ))}
          </div>
        )}
      </AdminCard>
    </div>
  );
};

export default Users;
import type { ICityProps } from "../../types";
import { EditButton, DeleteButton, ImageSection } from "../components";

export const CityItem = ({ city, onDelete }: ICityProps) => {
  return (
    <div className="group relative overflow-hidden rounded-2xl border border-zinc-200/20 dark:border-slate-700/20 bg-white dark:bg-slate-900 shadow-sm hover:shadow-md transition-all duration-300">
      {/* Image Section */}
      <div className="relative w-full h-64 sm:h-80 md:h-64">
        {city.images?.length ? (
          <ImageSection images={city.images} />
        ) : (
          <div className="w-full h-full bg-gradient-to-br from-sky-200/30 to-teal-200/20 dark:from-slate-800 dark:to-slate-900" />
        )}
        <div className="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent" />
        <h3 className="absolute bottom-3 left-3 text-lg sm:text-xl font-semibold text-white drop-shadow-md">
          {city.name}
        </h3>
      </div>

      {/* Description */}
      <div className="p-3 sm:p-4 flex flex-col justify-between space-y-2 sm:space-y-3">
        <p className="text-sm sm:text-base line-clamp-2 text-zinc-700 dark:text-zinc-300">
          {city.description || "No description provided."}
        </p>

        {/* Actions */}
        <div className="flex justify-end gap-2 mt-2">
          <EditButton to={`/admin/city/edit/${city._id}`} small />
          <DeleteButton
            id={city._id}
            onClick={() => onDelete(city._id)}
            small
          />
        </div>
      </div>
    </div>
  );
};
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import { BackButton, UploadImages, MessagePopup } from "../components";
import type { ICountry, IShowMessage } from "../../types";

export const AddCountry = () => {
  const navigate = useNavigate();
  const [form, setForm] = useState<Partial<ICountry>>({
    name: "",
    description: "",
  });
  const [files, setFiles] = useState<File[]>([]);
  const [previews, setPreviews] = useState<string[]>([]);
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState<IShowMessage | null>(null);

  const showMessage = (type: "error" | "success", text: string) => {
    setMessage({ type, text });
    setTimeout(() => setMessage(null), 2000);
  };

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => {
    const { name, value } = e.target;
    setForm((p) => ({ ...p, [name]: value }));
  };

  const handleUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (!e.target.files) return;
    const imgs = Array.from(e.target.files);
    if (files.length + imgs.length > 5) {
      showMessage("error", "Maximum 5 images allowed.");
      return;
    }
    setFiles((prev) => [...prev, ...imgs]);
    setPreviews((prev) => [
      ...prev,
      ...imgs.map((i) => URL.createObjectURL(i)),
    ]);
  };

  const handleDelete = (i: number) => {
    setFiles(files.filter((_, x) => x !== i));
    setPreviews(previews.filter((_, x) => x !== i));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!form.name?.trim())
      return showMessage("error", "Country name is required");

    try {
      setLoading(true);
      const formData = new FormData();
      formData.append("name", form.name || "");
      formData.append("description", form.description || "");
      files.forEach((f) => formData.append("country", f));

      await Axios.post("/country", formData, {
        headers: { "Content-Type": "multipart/form-data" },
      });
      showMessage("success", "Country added successfully!");
      setTimeout(() => navigate("/admin/country"), 1000);
    } catch {
      showMessage("error", "Failed to add country.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="max-w-3xl mx-auto p-6 sm:p-8 rounded-3xl glass backdrop-blur-md border border-white/10 shadow-lg animate-fade-in">
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-400 to-teal-400 flex items-center gap-2">
          Add New Country 🌍
        </h1>
        <BackButton to="/admin/country" />
      </div>

      <form onSubmit={handleSubmit} className="space-y-5">
        {/* Country Name */}
        <div>
          <label className="block text-sm text-gray-400 mb-1">
            Country Name
          </label>
          <input
            name="name"
            value={form.name}
            onChange={handleChange}
            placeholder="Enter country name..."
            className="w-full p-3 rounded-2xl bg-white/10 dark:bg-slate-800/30 text-white placeholder-gray-400 outline-none border border-white/20 focus:border-pink-400 focus:ring-1 focus:ring-pink-400 transition"
            required
          />
        </div>

        {/* Description */}
        <div>
          <label className="block text-sm text-gray-400 mb-1">
            Description
          </label>
          <textarea
            name="description"
            value={form.description}
            onChange={handleChange}
            placeholder="Write a short description..."
            rows={4}
            className="w-full p-3 rounded-2xl bg-white/10 dark:bg-slate-800/30 text-white placeholder-gray-400 outline-none border border-white/20 focus:border-teal-400 focus:ring-1 focus:ring-teal-400 transition resize-none"
          />
        </div>

        {/* Upload Images */}
        <UploadImages
          label="Country Images"
          previews={previews}
          onAdd={handleUpload}
          onDelete={handleDelete}
        />

        {/* Submit */}
        <button
          disabled={loading}
          className={`w-full py-3 rounded-2xl font-medium transition-all shadow-md ${
            loading
              ? "bg-gray-600/50 text-gray-300 cursor-not-allowed"
              : "bg-gradient-to-r from-pink-500 via-purple-400 to-teal-400 hover:brightness-110 text-white"
          }`}
        >
          {loading ? "Saving..." : "Add Country"}
        </button>
      </form>

      {message && <MessagePopup {...message} />}
    </div>
  );
};

export default AddCountry;
import { useState } from "react";
import { useForm } from "react-hook-form";
import { useNavigate } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import { UploadImages, MessagePopup } from "../components";
import type { INewCity, IShowMessage } from "../../types";

export const AddCity = () => {
  const navigate = useNavigate();
  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<INewCity>({
    defaultValues: { name: "", countryName: "", description: "" },
  });

  const [files, setFiles] = useState<File[]>([]);
  const [previews, setPreviews] = useState<string[]>([]);
  const [message, setMessage] = useState<IShowMessage | null>(null);
  const [loading, setLoading] = useState(false);

  const showMessage = (type: "success" | "error", text: string) => {
    setMessage({ type, text });
    setTimeout(() => setMessage(null), 2000);
  };

  const handleUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (!e.target.files) return;
    const imgs = Array.from(e.target.files);
    setFiles([...files, ...imgs]);
    setPreviews([...previews, ...imgs.map((f) => URL.createObjectURL(f))]);
  };

  const handleDelete = (index: number) => {
    setFiles(files.filter((_, i) => i !== index));
    setPreviews(previews.filter((_, i) => i !== index));
  };

  const onSubmit = async (data: INewCity) => {
    if (files.length === 0) {
      showMessage("error", "Upload at least one image.");
      return;
    }
    try {
      setLoading(true);
      const formData = new FormData();
      formData.append("name", data.name);
      formData.append("countryName", data.countryName);
      formData.append("description", data.description || "");
      files.forEach((f) => formData.append("city", f));
      await Axios.post("/city", formData, {
        headers: { "Content-Type": "multipart/form-data" },
      });
      showMessage("success", "City added successfully!");
      reset();
      setFiles([]);
      setPreviews([]);
      setTimeout(() => navigate("/admin/city"), 1000);
    } catch {
      showMessage("error", "Failed to add city.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="max-w-md mx-auto p-6 rounded-3xl bg-white/5 dark:bg-gray-900/40 backdrop-blur-lg border border-gray-200/20 shadow-md sm:p-8">
      <h1 className="text-xl sm:text-2xl font-bold text-white text-center mb-6">
        Add New City
      </h1>

      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        <input
          {...register("name", { required: true })}
          placeholder="City Name"
          className="w-full p-3 rounded-xl bg-white/10 dark:bg-gray-800 text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-400 focus:outline-none transition"
        />
        {errors.name && (
          <p className="text-red-400 text-sm">City is required</p>
        )}

        <input
          {...register("countryName", { required: true })}
          placeholder="Country Name"
          className="w-full p-3 rounded-xl bg-white/10 dark:bg-gray-800 text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-400 focus:outline-none transition"
        />
        {errors.countryName && (
          <p className="text-red-400 text-sm">Country is required</p>
        )}

        <textarea
          {...register("description")}
          placeholder="Description"
          rows={3}
          className="w-full p-3 rounded-xl bg-white/10 dark:bg-gray-800 text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-400 focus:outline-none transition resize-none"
        />

        <UploadImages
          label="Upload Images"
          previews={previews}
          onAdd={handleUpload}
          onDelete={handleDelete}
        />

        <button
          type="submit"
          disabled={loading}
          className="w-full py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-500 to-teal-500 hover:brightness-110 transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {loading ? "Saving..." : "Add City"}
        </button>
      </form>

      {message && <MessagePopup {...message} />}
    </div>
  );
};

export default AddCity;
import { useEffect, useState } from "react";
import { Globe2, MapPin, Users, ShieldCheck } from "lucide-react";
import { Axios } from "../../lib/axios-config";
import { AdminCard, EmptyState, Loader, MessagePopup } from "../components";
import type { IAccount, IResponse, IShowMessage, IStats } from "../../types";
import { useOutletContext } from "react-router-dom";

export const Admin = () => {
  const account = useOutletContext<IAccount>();
  const [stats, setStats] = useState<IStats>({
    countries: 0,
    cities: 0,
    users: 0,
    admins: 0,
  });
  const [loading, setLoading] = useState(true);
  const [message, setMessage] = useState<IShowMessage | null>(null);

  const showMessage = (type: "success" | "error", text: string) => {
    setMessage({ type, text });
    setTimeout(() => setMessage(null), 3000);
  };

  useEffect(() => {
    (async () => {
      try {
        setLoading(true);
        const { data } = await Axios.get<IResponse<IStats>>("admin/stats");
        setStats(data.payload);
      } catch {
        showMessage("error", "❌ Failed to load statistics.");
      } finally {
        setLoading(false);
      }
    })();
  }, []);

  if (loading) return <Loader />;
  if (!account || account.role !== "admin") {
    return (
      <EmptyState title="No Access" subtitle="You are not admin" icon="❌" />
    );
  }

  return (
    <div className="space-y-8 animate-fade-in p-4 sm:p-6">
      {message && <MessagePopup {...message} />}

      {/* Header */}
      <div className="text-center mb-6">
        <h1 className="text-3xl sm:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-400 to-teal-400">
          Admin Dashboard
        </h1>
        <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Overview of platform activity and data
        </p>
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
        <StatCard
          title="Countries"
          value={stats.countries}
          icon={<Globe2 className="h-6 w-6 text-pink-500" />}
          gradient="from-pink-200/40 to-pink-100/10"
        />
        <StatCard
          title="Cities"
          value={stats.cities}
          icon={<MapPin className="h-6 w-6 text-teal-500" />}
          gradient="from-teal-200/40 to-teal-100/10"
        />
        <StatCard
          title="Users"
          value={stats.users}
          icon={<Users className="h-6 w-6 text-purple-500" />}
          gradient="from-purple-200/40 to-purple-100/10"
        />
        <StatCard
          title="Admins"
          value={stats.admins}
          icon={<ShieldCheck className="h-6 w-6 text-indigo-500" />}
          gradient="from-indigo-200/40 to-indigo-100/10"
        />
      </div>

      {/* Recent Updates */}
      <AdminCard title="Recent Updates" icon="🕓">
        <EmptyState
          title="No recent updates yet"
          subtitle="Add countries, cities or manage users to see data here."
        />
      </AdminCard>
    </div>
  );
};

interface StatCardProps {
  title: string;
  value: number;
  icon: React.ReactNode;
  gradient: string;
}

function StatCard({ title, value, icon, gradient }: StatCardProps) {
  return (
    <div
      className={`relative p-5 rounded-2xl shadow-md hover:shadow-lg transition-all duration-300 backdrop-blur-md bg-gradient-to-br ${gradient}`}
    >
      <div className="flex items-center justify-between">
        <div>
          <p className="text-sm font-medium text-gray-500 dark:text-gray-400">
            {title}
          </p>
          <h3 className="text-3xl font-extrabold mt-1 text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-400 to-teal-400">
            {value}
          </h3>
        </div>
        <div className="p-3 rounded-xl bg-white/60 dark:bg-slate-800/60 shadow-inner">
          {icon}
        </div>
      </div>
    </div>
  );
}

export default Admin;
import { useEffect, useMemo, useState } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import { Loader, MessagePopup, BackButton } from "../components";
import type { IAccount, IResponse, IShowMessage } from "../../types";
import { useForm } from "react-hook-form";

export const EditUser = () => {
  const { id } = useParams();
  const navigate = useNavigate();

  const [user, setUser] = useState<IAccount | null>(null);
  const [message, setMessage] = useState<IShowMessage | null>(null);
  const [loading, setLoading] = useState(false);

  const { register, handleSubmit, reset, watch } = useForm<IAccount>();

  useEffect(() => {
    if (id) fetchUser();
  }, [id]);

  const fetchUser = async () => {
    try {
      setLoading(true);
      const { data } = await Axios.get<IResponse<IAccount>>(
        `/account/user/${id}`
      );
      setUser(data.payload);
      reset(data.payload);
    } catch {
      setMessage({ type: "error", text: "Failed to load user data." });
    } finally {
      setLoading(false);
    }
  };

  const onSubmit = async (data: IAccount) => {
    if (!canSave) return;
    try {
      await Axios.patch(`/user/${id}`, { role: data.role });
      setMessage({ type: "success", text: "User role updated successfully!" });
      setTimeout(() => navigate("/admin/users"), 1000);
    } catch {
      setMessage({ type: "error", text: "Failed to update user role." });
    }
  };

  const roleValue = watch("role");
  const canSave = useMemo(
    () => user && roleValue !== user.role,
    [roleValue, user]
  );

  if (loading || !user) return <Loader />;

  return (
    <div className="flex justify-center items-start py-10 px-4 min-h-[80vh] bg-gradient-to-br from-sky-50 dark:from-[#050911] transition-colors">
      <div className="w-full max-w-md bg-white dark:bg-[#0c101a] rounded-2xl shadow-lg p-6 relative flex flex-col space-y-6">
        {/* Header */}
        <div className="flex justify-between items-center mb-4">
          <h1 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-sky-400 via-teal-400 to-emerald-400">
            Edit User ✏️
          </h1>
          <BackButton to="/admin/users" />
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div className="flex flex-col space-y-2">
            <label className="text-sm text-zinc-700 dark:text-zinc-300">
              Username
            </label>
            <input
              value={user.username}
              readOnly
              className="w-full p-3 rounded-xl bg-gray-100 dark:bg-[#0f1624] text-zinc-700 dark:text-zinc-300 cursor-not-allowed border border-gray-300 dark:border-gray-700"
            />
          </div>

          <div className="flex flex-col space-y-2">
            <label className="text-sm text-zinc-700 dark:text-zinc-300">
              Email
            </label>
            <input
              value={user.email}
              readOnly
              className="w-full p-3 rounded-xl bg-gray-100 dark:bg-[#0f1624] text-zinc-700 dark:text-zinc-300 cursor-not-allowed border border-gray-300 dark:border-gray-700"
            />
          </div>

          <div className="flex flex-col space-y-2">
            <label className="text-sm text-zinc-700 dark:text-zinc-300">
              Role
            </label>
            <select
              {...register("role")}
              defaultValue={user.role}
              className="w-full p-3 rounded-xl bg-white dark:bg-[#0f1624] text-zinc-900 dark:text-zinc-100 border border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-emerald-400 outline-none transition"
            >
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
          </div>

          <button
            disabled={!canSave}
            className={`w-full py-3 rounded-xl font-semibold transition-all ${
              !canSave
                ? "bg-gray-300 dark:bg-gray-800 text-gray-500 cursor-not-allowed"
                : "bg-gradient-to-r from-sky-500 via-teal-400 to-emerald-500 text-white hover:shadow-lg"
            }`}
          >
            {canSave ? "Save Changes" : "No Changes"}
          </button>
        </form>

        {message && <MessagePopup type={message.type} text={message.text} />}
      </div>
    </div>
  );
};

export default EditUser;
// src/pages/trip/trip.tsx
import React, { useEffect, useMemo, useState } from "react";
import { Outlet, useNavigate, useLocation } from "react-router-dom";
import { ChevronLeft } from "lucide-react";

interface TripData {
  countryId?: string;
  tripId?: string;
  startDate?: string;
  endDate?: string;
  cityId?: string;
  hotelId?: string | null;
}

interface CompletedSteps {
  country: boolean;
  planning: boolean;
  city: boolean;
  hotel: boolean;
  dayPlanning: boolean;
  finish: boolean;
}

const DEFAULT_COMPLETED: CompletedSteps = {
  country: false,
  planning: false,
  city: false,
  hotel: false,
  dayPlanning: false,
  finish: false,
};

const wizardSteps = [
  { key: "country", label: "Country" },
  { key: "planning", label: "Planning" },
  { key: "city", label: "City" },
  { key: "hotel", label: "Hotel" },
  { key: "day-planning", label: "Days" },
  { key: "finish", label: "Finish" },
];

export const Trip: React.FC = () => {
  const navigate = useNavigate();
  const location = useLocation();

  const [tripData, setTripDataState] = useState<TripData>({});
  const [completed, setCompletedState] =
    useState<CompletedSteps>(DEFAULT_COMPLETED);

  const setTripData = (patch: Partial<TripData>) =>
    setTripDataState((prev) => ({ ...prev, ...patch }));
  const setCompleted = (patch: Partial<CompletedSteps>) =>
    setCompletedState((prev) => ({ ...prev, ...patch }));

  const currentStep = location.pathname.split("/").pop() || "country";
  const currentIndex = wizardSteps.findIndex((s) => s.key === currentStep);

  // === STRICT NAVIGATION CHECK ===
  useEffect(() => {
    if (currentStep === "country") return;
    if (currentStep === "planning" && !completed.country) {
      navigate("/trips/new/country", { replace: true });
      return;
    }
    if (currentStep === "finish" && !completed.dayPlanning) {
      navigate("/trips/new/day-planning", { replace: true });
      return;
    }
  }, [currentStep, completed, navigate]);

  const getTitle = () => {
    switch (currentStep) {
      case "country":
        return "Choose destination";
      case "planning":
        return "Trip dates";
      case "city":
        return "Choose city";
      case "hotel":
        return "Select hotel";
      case "day-planning":
        return "Plan days";
      case "finish":
        return "Done";
      default:
        return "New trip";
    }
  };

  const contextValue = useMemo(
    () => ({
      tripData,
      setTripData,
      completed,
      setCompleted,
    }),
    [tripData, completed]
  );

  return (
    <div className="min-h-screen bg-white dark:bg-black flex flex-col">
      {/* Header */}
      <div className="sticky top-0 z-20 bg-white dark:bg-black border-b border-zinc-200 dark:border-zinc-800">
        {/* Progress (Instagram stories) */}
        <div className="flex gap-1 px-2 pt-2">
          {wizardSteps.map((_, i) => (
            <div
              key={i}
              className={`h-1 flex-1 rounded-full ${
                i <= currentIndex
                  ? "bg-zinc-900 dark:bg-white"
                  : "bg-zinc-200 dark:bg-zinc-800"
              }`}
            />
          ))}
        </div>

        {/* Top bar */}
        <div className="h-12 px-3 flex items-center">
          <button onClick={() => navigate(-1)} className="p-2 -ml-2">
            <ChevronLeft />
          </button>
          <h1 className="flex-1 text-center text-sm font-semibold">
            {getTitle()}
          </h1>
          <div className="w-8" />
        </div>
      </div>

      {/* Content */}
      <div className="flex-1 overflow-y-auto">
        <div className="max-w-xl mx-auto px-4 py-6">
          <Outlet context={contextValue} />
        </div>
      </div>
    </div>
  );
};

export default Trip;
import { useEffect, useState } from "react";
import { Outlet, useLocation, useNavigate } from "react-router-dom";
import {
  Home,
  PlusCircle,
  Globe2,
  CalendarDays,
  Coffee,
  CheckCircle2,
  Menu,
  X,
  ArrowLeft,
  Users,
} from "lucide-react";

const wizardSteps = [
  { key: "country", label: "Country", icon: Globe2, to: "country" },
  { key: "planning", label: "Trip Info", icon: CalendarDays, to: "planning" },
  {
    key: "day-planning",
    label: "Day Planning",
    icon: Coffee,
    to: "day-planning",
  },
  { key: "finish", label: "Finish", icon: CheckCircle2, to: "finish" },
];

export default function TripDashboard() {
  const navigate = useNavigate();
  const location = useLocation();

  const [mobileDrawer, setMobileDrawer] = useState(false);
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth < 768);
    handleResize();
    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, []);

  const isInWizard = location.pathname.startsWith("/trips/new");
  const currentWizardStep = isInWizard
    ? location.pathname.split("/").pop()
    : null;
  const showBackButton =
    isInWizard || location.pathname.match(/\/trips\/(edit|\d+)$/);

  const SidebarContent = ({ onNavigate }: { onNavigate?: () => void }) => (
    <nav className="mt-2 px-3 flex-1 space-y-1 overflow-y-auto">
      <button
        onClick={() => {
          navigate("/trips");
          onNavigate?.();
        }}
        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition ${
          !isInWizard ? "bg-indigo-600/20 text-indigo-300" : "hover:bg-white/5"
        }`}
      >
        <Home className="h-5 w-5" />
        {sidebarOpen && <span>My Trips</span>}
      </button>

      <div className="pt-2">
        <button
          onClick={() => {
            navigate("/trips/new/country");
            onNavigate?.();
          }}
          className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition ${
            isInWizard
              ? "bg-emerald-600/20 text-emerald-300"
              : "hover:bg-white/5"
          }`}
        >
          <PlusCircle className="h-5 w-5" />
          {sidebarOpen && <span>New Trip</span>}
        </button>

        {sidebarOpen && isInWizard && (
          <div className="mt-2 ml-6 space-y-1">
            {wizardSteps.map((s) => {
              const Icon = s.icon;
              const active = currentWizardStep === s.to;
              return (
                <button
                  key={s.key}
                  onClick={() => {
                    navigate(`/trips/new/${s.to}`);
                    onNavigate?.();
                  }}
                  className={`w-full flex items-center gap-3 px-4 py-2 rounded-xl text-sm transition ${
                    active
                      ? "bg-white/10 text-white"
                      : "text-zinc-400 hover:bg-white/5 hover:text-white"
                  }`}
                >
                  <Icon className="h-4 w-4" />
                  <span>{s.label}</span>
                </button>
              );
            })}
          </div>
        )}
      </div>
    </nav>
  );

  return (
    <div className="min-h-screen flex flex-col md:flex-row">
      {/* Background Gradient */}
      <div className="pointer-events-none fixed inset-0 -z-10">
        <div className="absolute inset-0 bg-gradient-to-br from-[#0b0f19] via-[#131829] to-[#0b0f19]" />
        <div className="absolute -top-32 left-1/2 -translate-x-1/2 h-[26rem] w-[46rem] rounded-full blur-3xl opacity-20 bg-gradient-to-r from-indigo-600 to-purple-600" />
      </div>

      {/* Sidebar Desktop */}
      <aside
        className={`hidden md:flex flex-col transition-all duration-300 m-3 rounded-3xl border border-white/10 bg-white/5 backdrop-blur-xl ${
          sidebarOpen ? "w-72" : "w-20"
        }`}
      >
        <div className="flex items-center gap-3 px-4 py-4">
          <div className="h-10 w-10 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
            <Globe2 className="h-5 w-5 text-white" />
          </div>
          {sidebarOpen && (
            <div className="flex-1">
              <p className="font-semibold">Bardiner Trips</p>
              <p className="text-xs text-zinc-400">Dashboard</p>
            </div>
          )}
          <button
            onClick={() => setSidebarOpen(!sidebarOpen)}
            className="ml-auto h-9 w-9 rounded-xl border border-white/10 hover:bg-white/10 flex items-center justify-center"
          >
            {sidebarOpen ? <X /> : <Menu />}
          </button>
        </div>
        <SidebarContent />
      </aside>

      {/* Mobile Drawer */}
      {isMobile && mobileDrawer && (
        <div className="fixed inset-0 z-50">
          <div
            className="absolute inset-0 bg-black/40"
            onClick={() => setMobileDrawer(false)}
          />
          <aside className="absolute left-0 top-0 h-full w-72 p-3 bg-[#0b0f19] border-r border-white/10">
            <div className="flex items-center justify-between px-2 py-2">
              <p className="font-semibold">Bardiner Trips</p>
              <button onClick={() => setMobileDrawer(false)}>
                <X />
              </button>
            </div>
            <SidebarContent onNavigate={() => setMobileDrawer(false)} />
          </aside>
        </div>
      )}

      {/* Main content */}
      <div className="flex-1 flex flex-col min-w-0">
        {/* Top Navbar */}
        <div className="flex justify-between items-center p-4 bg-white/5 dark:bg-[#0b0f19]/70 backdrop-blur-lg rounded-2xl shadow-md m-3">
          <div className="text-xl font-bold text-white">Bardiner</div>
          <div className="flex gap-4 items-center">
            <button onClick={() => navigate("/trips/new/country")}>
              <PlusCircle className="h-6 w-6 text-white" />
            </button>
            {isMobile && (
              <button onClick={() => setMobileDrawer(true)}>
                <Menu className="h-6 w-6 text-white" />
              </button>
            )}
          </div>
        </div>

        {/* Back button */}
        {showBackButton && (
          <div className="px-4 mt-2 md:mt-4">
            <button
              onClick={() => navigate("/trips")}
              className="flex items-center gap-2 text-zinc-400 hover:text-white"
            >
              <ArrowLeft /> Back to Dashboard
            </button>
          </div>
        )}

        {/* Outlet (Feed / Wizard) */}
        <div className="flex-1 overflow-y-auto p-4 space-y-4 md:p-6">
          <Outlet />
        </div>

        {/* Mobile Bottom Navigation */}
        {isMobile && (
          <div className="fixed bottom-0 left-0 right-0 flex justify-around bg-white/5 dark:bg-[#0b0f19]/70 backdrop-blur-lg p-2 rounded-t-3xl shadow-lg md:hidden">
            <Home className="h-6 w-6 text-white" />
            <PlusCircle className="h-6 w-6 text-white" />
            <CalendarDays className="h-6 w-6 text-white" />
            <Globe2 className="h-6 w-6 text-white" />
            <Users className="h-6 w-6 text-white" />
          </div>
        )}
      </div>
    </div>
  );
}
import React, { useEffect, useRef, useState } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import { Loader } from "../components";
import toast from "react-hot-toast";
import {
  CalendarIcon,
  MapPin,
  Hotel,
  Activity,
  Moon,
  Coffee,
  Lock,
  CheckCircle,
  ArrowLeft,
} from "lucide-react";
import dayjs from "dayjs";

interface TripDay {
  _id: string;
  order: number;
  date: string;
  cityName: string;
  hotel?: { name: string; address: string };
  activities: Array<{
    type: string;
    activity: { name: string; address: string };
    notes?: string;
    cost?: number;
  }>;
}

interface Trip {
  _id: string;
  title: string;
  description: string;
  startDate: string;
  endDate: string;
  isPrivate: boolean;
  isCompleted?: boolean;
  coverImage?: string;
  days: TripDay[];
}

const TripView: React.FC = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const [trip, setTrip] = useState<Trip | null>(null);
  const [loading, setLoading] = useState(true);
  const app = useRef(import.meta.env.VITE_APP_DOMAIN);

  useEffect(() => {
    if (!id) return;
    Axios.get(`/trip/${id}`)
      .then(({ data }) => setTrip(data.payload))
      .catch(() => toast.error("Failed to load trip"))
      .finally(() => setLoading(false));
  }, [id]);

  if (loading) return <Loader />;
  if (!trip) return null;

  return (
    <div className="min-h-screen bg-white dark:bg-black">
      {/* Header */}
      <div className="sticky top-0 z-10 bg-white dark:bg-black border-b border-zinc-200 dark:border-zinc-800 px-4 h-12 flex items-center">
        <button
          onClick={() => navigate("/trips")}
          className="flex items-center gap-2 text-sm font-medium"
        >
          <ArrowLeft size={18} /> Trips
        </button>
      </div>

      {/* Content */}
      <div className="max-w-xl mx-auto">
        {/* Cover */}
        {trip.coverImage && (
          <img
            src={app.current + trip.coverImage}
            alt="cover"
            className="w-full aspect-square object-cover"
          />
        )}

        {/* Info */}
        <div className="px-4 py-3 space-y-2 border-b border-zinc-200 dark:border-zinc-800">
          <h1 className="text-lg font-semibold">{trip.title}</h1>

          <p className="text-sm text-zinc-500">{trip.description}</p>

          <div className="flex items-center gap-3 text-xs text-zinc-500">
            <span className="flex items-center gap-1">
              <CalendarIcon size={14} />
              {dayjs(trip.startDate).format("MMM D")} –{" "}
              {dayjs(trip.endDate).format("MMM D")}
            </span>
            {trip.isPrivate && <Lock size={14} />}
            {trip.isCompleted && (
              <CheckCircle size={14} className="text-emerald-500" />
            )}
          </div>
        </div>

        {/* Days Feed */}
        <div className="divide-y divide-zinc-200 dark:divide-zinc-800">
          {trip.days
            .sort((a, b) => a.order - b.order)
            .map((day) => (
              <div key={day._id} className="px-4 py-4 space-y-3">
                {/* Day header */}
                <div className="flex items-center justify-between">
                  <h2 className="font-medium text-sm">
                    Day {day.order} · {dayjs(day.date).format("MMM D")}
                  </h2>
                  <span className="flex items-center gap-1 text-xs text-zinc-500">
                    <MapPin size={12} /> {day.cityName}
                  </span>
                </div>

                {/* Hotel */}
                {day.hotel && (
                  <div className="flex gap-2 text-sm">
                    <Hotel size={16} className="mt-0.5" />
                    <div>
                      <p className="font-medium">{day.hotel.name}</p>
                      <p className="text-xs text-zinc-500">
                        {day.hotel.address}
                      </p>
                    </div>
                  </div>
                )}

                {/* Activities */}
                <div className="space-y-2">
                  {day.activities.map((act, i) => (
                    <div key={i} className="flex gap-2 text-sm items-start">
                      {act.type === "night" ? (
                        <Moon size={16} />
                      ) : act.type === "cafe" ? (
                        <Coffee size={16} />
                      ) : (
                        <Activity size={16} />
                      )}

                      <div className="flex-1">
                        <p className="font-medium">{act.activity.name}</p>
                        <p className="text-xs text-zinc-500">
                          {act.activity.address}
                        </p>
                        {act.notes && (
                          <p className="text-xs text-zinc-400 mt-1">
                            {act.notes}
                          </p>
                        )}
                        {act.cost && (
                          <p className="text-xs text-zinc-400">
                            Cost: {act.cost}
                          </p>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            ))}
        </div>
      </div>
    </div>
  );
};

export default TripView;
// src/pages/Finish.tsx
import React, { useRef, useState } from "react";
import { useNavigate, useOutletContext } from "react-router-dom";
import { Axios } from "../../../lib/axios-config";
import { ImagePlus, ChevronLeft } from "lucide-react";

export const Finish: React.FC = () => {
  const navigate = useNavigate();
  const { tripData, setCompleted } = useOutletContext<any>();

  const [file, setFile] = useState<File | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const inputRef = useRef<HTMLInputElement | null>(null);

  const upload = async () => {
    if (!file) return;

    const form = new FormData();
    form.append("cover", file);

    setLoading(true);
    setError(null);

    try {
      await Axios.post(`/trip/${tripData.tripId}/cover`, form);
      setCompleted({ finish: true });
      navigate(`/trip/${tripData.tripId}`);
    } catch {
      setError("Failed to upload cover");
    } finally {
      setLoading(false);
    }
  };

  const useDefault = async () => {
    setLoading(true);
    setError(null);

    try {
      await Axios.post(`/trip/${tripData.tripId}/cover`, { useDefault: true });
      setCompleted({ finish: true });
      navigate(`/trip/${tripData.tripId}`);
    } catch {
      setError("Failed to set default cover");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-white dark:bg-black">
      {/* HEADER */}
      <div className="sticky top-0 z-20 bg-white dark:bg-black border-b border-zinc-200 dark:border-zinc-800">
        <div className="h-12 px-3 flex items-center">
          <button onClick={() => navigate(-1)} className="p-2 -ml-2">
            <ChevronLeft />
          </button>
          <h1 className="flex-1 text-center text-sm font-semibold">
            Add cover
          </h1>
          <button
            onClick={useDefault}
            disabled={loading}
            className="text-sm text-sky-500 font-medium disabled:opacity-50"
          >
            Skip
          </button>
        </div>
      </div>

      {/* CONTENT */}
      <div className="max-w-sm mx-auto px-4 pt-8 pb-32 flex flex-col items-center gap-6">
        <p className="text-sm text-zinc-500 text-center">
          Choose a cover image for your trip
        </p>

        {/* COVER PREVIEW (Instagram post style) */}
        <div
          onClick={() => inputRef.current?.click()}
          className="
            w-full aspect-[4/5]
            rounded-xl overflow-hidden
            bg-zinc-100 dark:bg-zinc-900
            border border-zinc-200 dark:border-zinc-800
            flex items-center justify-center
            cursor-pointer
            active:scale-[0.98]
            transition
          "
        >
          {file ? (
            <img
              src={URL.createObjectURL(file)}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="flex flex-col items-center gap-3 text-zinc-400">
              <ImagePlus className="w-9 h-9" />
              <span className="text-xs">Tap to upload</span>
            </div>
          )}
        </div>

        {error && <p className="text-xs text-red-500 text-center">{error}</p>}

        <input
          ref={inputRef}
          type="file"
          accept="image/*"
          hidden
          onChange={(e) => setFile(e.target.files?.[0] || null)}
        />
      </div>

      {/* BOTTOM CTA */}
      <div className="fixed bottom-0 inset-x-0 bg-white/90 dark:bg-black/90 backdrop-blur border-t border-zinc-200 dark:border-zinc-800 px-4 py-3">
        <button
          onClick={upload}
          disabled={loading || !file}
          className="
            w-full h-11 rounded-md
            bg-sky-500 text-white text-sm font-semibold
            disabled:opacity-40
          "
        >
          {loading ? "Saving…" : "Finish"}
        </button>
      </div>
    </div>
  );
};

export default Finish;
import React, { useEffect, useState } from "react";
import { useNavigate, useOutletContext } from "react-router-dom";
import { Axios } from "../../../lib/axios-config";
import type { ICountry, IResponse, ITripItem } from "../../../types";
import { useDebounce } from "../../../hooks/useDebounce";
import { ImageCarousel } from "../../components";
import { Globe2, Search } from "lucide-react";

export const Country: React.FC = () => {
  const navigate = useNavigate();
  const { tripData, setTripData, setCompleted } = useOutletContext<{
    tripData: any;
    setTripData(d: Partial<any>): void;
    setCompleted(p: Partial<ITripItem>): void;
  }>();

  const [q, setQ] = useState("");
  const [countries, setCountries] = useState<ICountry[]>([]);
  const [loading, setLoading] = useState(false);

  const debounced = useDebounce(q, 700);

  useEffect(() => {
    if (!debounced.trim()) return setCountries([]);

    let mounted = true;
    (async () => {
      try {
        setLoading(true);
        const { data } = await Axios.get<IResponse<ICountry[]>>(
          `/country?name=${encodeURIComponent(debounced)}`
        );
        if (!mounted) return;
        setCountries(data.payload || []);
      } finally {
        setLoading(false);
      }
    })();

    return () => {
      mounted = false;
    };
  }, [debounced]);

  const selectCountry = (id: string) => {
    setTripData({ countryId: id });
    setCompleted({ country: true });
    navigate("/trips/new/planning");
  };

  return (
    <div className="max-w-5xl mx-auto px-4 py-8 space-y-6">
      {/* HEADER */}
      <div className="text-center sm:text-left">
        <h1 className="text-2xl sm:text-4xl font-bold text-white tracking-tight">
          Choose destination
        </h1>
        <p className="text-zinc-500 mt-1 hidden sm:block">
          Search and select a country to start your trip
        </p>
      </div>

      {/* SEARCH */}
      <div className="relative">
        <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-zinc-500" />
        <input
          value={q}
          onChange={(e) => setQ(e.target.value)}
          placeholder="Search country"
          className="
            w-full pl-12 pr-4 py-3 rounded-full
            bg-white/5 border border-white/10
            text-white placeholder-zinc-500
            focus:outline-none focus:ring-2 focus:ring-blue-600
            transition
          "
        />
      </div>

      {/* LOADING */}
      {loading && (
        <div className="text-center text-zinc-400 animate-pulse">
          Searching…
        </div>
      )}

      {/* RESULTS */}
      <div className="space-y-6 sm:grid sm:grid-cols-2 lg:grid-cols-3 sm:gap-6 sm:space-y-0">
        {countries.map((c) => (
          <div
            key={c._id}
            className="
              relative overflow-hidden rounded-3xl
              bg-white/5 border border-white/10
              shadow-sm hover:shadow-lg
              cursor-pointer transition-all duration-300
            "
          >
            {c.images.length > 0 && (
              <div className="aspect-[4/5]">
                <ImageCarousel images={c.images} />
              </div>
            )}

            {/* OVERLAY */}
            <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent" />

            {/* CONTENT */}
            <div className="absolute bottom-0 left-0 right-0 p-4 space-y-2">
              <div className="text-lg font-semibold text-white">{c.name}</div>

              {c.description && (
                <div className="text-sm text-zinc-300 line-clamp-2">
                  {c.description}
                </div>
              )}

              <button
                onClick={() => selectCountry(c._id)}
                className="
                  mt-2 w-full py-2.5 rounded-full
                  bg-gradient-to-r from-blue-500 to-blue-600
                  text-white text-sm font-semibold
                  active:scale-[0.98]
                  transition
                "
              >
                Create Trip
              </button>
            </div>
          </div>
        ))}
      </div>

      {/* EMPTY STATE */}
      {!loading && countries.length === 0 && (
        <div className="flex flex-col items-center justify-center py-20 space-y-4">
          <Globe2 className="w-20 h-20 text-zinc-600" />
          <p className="text-zinc-400 text-center text-lg">
            {q.trim() ? "No countries found" : "Search for a country to begin"}
          </p>
        </div>
      )}
    </div>
  );
};

export default Country;
import React from "react";
import type { ITripDayLocal } from "../trip.types";

interface DaySelectorProps {
  tripDays: ITripDayLocal[];
  selectedIndex: number;
  setSelectedIndex: (i: number) => void;
}

const DaySelector: React.FC<DaySelectorProps> = ({
  tripDays,
  selectedIndex,
  setSelectedIndex,
}) => {
  return (
    <div className="relative">
      {/* DAY CHIPS */}
      <div
        className="
          flex gap-3 overflow-x-auto no-scrollbar
          px-2 py-3
        "
      >
        {tripDays.map((d, i) => {
          const active = i === selectedIndex;

          return (
            <button
              key={d.day}
              onClick={() => setSelectedIndex(i)}
              className={`
                shrink-0 px-4 h-9 rounded-full text-sm font-semibold
                transition-all
                ${
                  active
                    ? `
                      bg-gradient-to-r from-indigo-500 to-purple-500
                      text-white shadow-md scale-[1.05]
                    `
                    : `
                      bg-white/5 text-zinc-400
                      hover:bg-white/10
                    `
                }
              `}
            >
              Day {d.day}
            </button>
          );
        })}
      </div>

      {/* PROGRESS INDICATOR (stories style) */}
      <div className="px-2">
        <div className="h-[3px] bg-white/10 rounded-full overflow-hidden">
          <div
            className="
              h-full
              bg-gradient-to-r from-indigo-500 to-purple-500
              transition-all duration-300
            "
            style={{
              width: `${((selectedIndex + 1) / tripDays.length) * 100}%`,
            }}
          />
        </div>
      </div>
    </div>
  );
};

export default DaySelector;
import {
  Utensils,
  Clock,
  MapPin,
  Phone,
  Globe,
  Mail,
  Cigarette,
  CigaretteOff,
  Star as StarIcon,
  Check,
} from "lucide-react";

export const ActivityCard = ({
  activity,
  selected,
  onClick,
  disabled = false,
  isHotel = false,
}: {
  activity: any;
  selected: boolean;
  onClick: () => void;
  disabled?: boolean;
  isHotel?: boolean;
}) => {
  const image = activity.image || activity.images?.[0];

  return (
    <button
      onClick={disabled ? undefined : onClick}
      disabled={disabled}
      className={`
        relative w-full text-left overflow-hidden
        rounded-2xl
        bg-white/5 border border-white/10
        transition
        active:scale-[0.98]
        ${disabled ? "opacity-60" : "hover:bg-white/10"}
      `}
    >
      {/* IMAGE */}
      <div className="relative aspect-[4/5]">
        {image ? (
          <img
            src={image}
            alt={activity.name}
            className="absolute inset-0 w-full h-full object-cover"
          />
        ) : (
          <div className="absolute inset-0 bg-zinc-900 flex items-center justify-center">
            {isHotel ? (
              <StarIcon className="w-12 h-12 text-zinc-600" />
            ) : (
              <Utensils className="w-12 h-12 text-zinc-600" />
            )}
          </div>
        )}

        {/* DARK OVERLAY */}
        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent" />

        {/* SELECTED CHECK */}
        {selected && (
          <div className="absolute top-3 right-3 w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center">
            <Check className="w-4 h-4 text-white" />
          </div>
        )}
      </div>

      {/* CONTENT */}
      <div className="p-4 space-y-2">
        <div className="text-white font-semibold text-lg line-clamp-1">
          {activity.name || "Untitled"}
        </div>

        {/* STARS (HOTEL) */}
        {isHotel && activity.stars && (
          <div className="flex items-center gap-1">
            {[...Array(5)].map((_, i) => (
              <StarIcon
                key={i}
                className={`w-4 h-4 ${
                  i < activity.stars
                    ? "text-yellow-400 fill-yellow-400"
                    : "text-zinc-600"
                }`}
              />
            ))}
            <span className="ml-1 text-xs text-zinc-400">
              {activity.stars}★
            </span>
          </div>
        )}

        {/* META */}
        {!isHotel && activity.smoking !== undefined && (
          <div className="flex items-center gap-2 text-xs">
            {activity.smoking ? (
              <>
                <Cigarette className="w-3.5 h-3.5 text-orange-400" />
                <span className="text-orange-300">Smoking allowed</span>
              </>
            ) : (
              <>
                <CigaretteOff className="w-3.5 h-3.5 text-emerald-400" />
                <span className="text-emerald-300">Non-smoking</span>
              </>
            )}
          </div>
        )}

        {activity.openingHours && (
          <div className="flex items-center gap-2 text-xs text-zinc-400">
            <Clock className="w-3.5 h-3.5" />
            <span className="line-clamp-1">{activity.openingHours}</span>
          </div>
        )}

        {activity.address && (
          <div className="flex items-center gap-2 text-xs text-zinc-500">
            <MapPin className="w-3.5 h-3.5" />
            <span className="line-clamp-1">{activity.address}</span>
          </div>
        )}

        {/* CONTACT */}
        <div className="flex gap-4 pt-2 text-xs text-zinc-400">
          {activity.phone && <Phone className="w-4 h-4" />}
          {activity.website && <Globe className="w-4 h-4" />}
          {activity.email && <Mail className="w-4 h-4" />}
        </div>
      </div>
    </button>
  );
};

export default ActivityCard;
import React, { useEffect, useState } from "react";
import { useNavigate, useOutletContext } from "react-router-dom";
import { MapPin } from "lucide-react";
import { ImageCarousel } from "../../components"; // եթե city.images են լինելու
import { Axios } from "../../../lib/axios-config";

export const City: React.FC = () => {
  const navigate = useNavigate();
  const { tripData, setTripData } = useOutletContext<any>();

  const [cities, setCities] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!tripData.countryId) {
      navigate("/trips/country");
      return;
    }

    let mounted = true;
    Axios.get(`/city/all/${tripData.countryId}`)
      .then((res) => {
        if (!mounted) return;
        setCities(res.data.payload || []);
      })
      .finally(() => {
        if (!mounted) return;
        setLoading(false);
      });

    return () => {
      mounted = false;
    };
  }, [tripData.countryId]);

  const selectCity = (id: string) => {
    setTripData({ cityId: id });
    navigate("/trips/hotel");
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen text-zinc-400 animate-pulse">
        Loading…
      </div>
    );
  }

  return (
    <div className="max-w-5xl mx-auto px-4 py-8 space-y-6">
      {/* HEADER */}
      <div className="text-center sm:text-left">
        <h1 className="text-2xl sm:text-4xl font-bold text-white tracking-tight">
          Choose a city
        </h1>
        <p className="text-zinc-500 mt-1 hidden sm:block">
          Select a city to continue planning
        </p>
      </div>

      {/* EMPTY STATE */}
      {cities.length === 0 && (
        <div className="flex flex-col items-center justify-center py-24 space-y-4">
          <MapPin className="w-20 h-20 text-zinc-600" />
          <p className="text-zinc-400 text-lg text-center">No cities found</p>
        </div>
      )}

      {/* CITIES GRID */}
      <div className="space-y-4 sm:grid sm:grid-cols-2 lg:grid-cols-3 sm:gap-6 sm:space-y-0">
        {cities.map((city) => (
          <button
            key={city._id}
            onClick={() => selectCity(city._id)}
            className="
              relative w-full text-left
              overflow-hidden rounded-3xl
              bg-white/5 border border-white/10
              shadow-sm hover:shadow-lg
              transition-all duration-300
              active:scale-[0.98]
            "
          >
            {city.images?.length > 0 && (
              <div className="aspect-[4/5]">
                <ImageCarousel images={city.images} />
              </div>
            )}

            {/* OVERLAY */}
            <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent" />

            <div className="relative flex items-center gap-4 p-4">
              <div className="flex items-center justify-center w-12 h-12 rounded-xl bg-white/10 text-indigo-400 shrink-0">
                <MapPin className="w-5 h-5" />
              </div>

              <div className="flex-1 min-w-0">
                <div className="text-white font-semibold truncate">
                  {city.name}
                </div>
                <div className="text-sm text-zinc-300 line-clamp-2">
                  {city.description || "Beautiful city to explore"}
                </div>
              </div>
            </div>
          </button>
        ))}
      </div>
    </div>
  );
};

export default City;
// src/pages/Planning.tsx
import React, { useState } from "react";
import { useNavigate, useOutletContext } from "react-router-dom";
import { Axios } from "../../../lib/axios-config";
import type { ITripItem } from "../../../types";
import { ChevronLeft } from "lucide-react";

export const Planning: React.FC = () => {
  const navigate = useNavigate();
  const { tripData, setTripData, setCompleted } = useOutletContext<{
    tripData: any;
    setTripData(d: Partial<any>): void;
    setCompleted(p: Partial<ITripItem>): void;
  }>();

  const [form, setForm] = useState({
    title: "",
    description: "",
    startDate: "",
    endDate: "",
  });

  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const onChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => setForm((p) => ({ ...p, [e.target.name]: e.target.value }));

  const validate = () => {
    if (!form.title) return "Trip title is required";
    if (!form.startDate || !form.endDate) return "Select travel dates";
    if (new Date(form.startDate) > new Date(form.endDate))
      return "Start date cannot be after end date";
    return null;
  };

  const submit = async () => {
    const err = validate();
    if (err) return setError(err);
    if (!tripData?.countryId) return setError("Country must be selected first");

    try {
      setLoading(true);
      setError(null);

      const { data } = await Axios.post("/trip", {
        ...form,
        countryId: tripData.countryId,
      });

      if (!data?.payload?._id) throw new Error();

      setTripData({
        tripId: data.payload._id,
        startDate: form.startDate,
        endDate: form.endDate,
      });

      setCompleted({ planning: true });
      navigate("/trips/new/day-planning");
    } catch {
      setError("Failed to create trip");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-white dark:bg-black">
      {/* HEADER */}
      <div className="sticky top-0 z-20 bg-white dark:bg-black border-b border-zinc-200 dark:border-zinc-800">
        <div className="h-12 px-3 flex items-center">
          <button onClick={() => navigate(-1)} className="p-2 -ml-2">
            <ChevronLeft />
          </button>
          <h1 className="flex-1 text-center text-sm font-semibold">New trip</h1>
          <button
            onClick={submit}
            disabled={loading}
            className="text-sm font-semibold text-sky-500 disabled:opacity-40"
          >
            Next
          </button>
        </div>
      </div>

      {/* CONTENT */}
      <div className="max-w-xl mx-auto px-4 py-6 space-y-6">
        {error && <p className="text-sm text-red-500">{error}</p>}

        {/* Title */}
        <div className="space-y-1">
          <label className="text-xs text-zinc-500">Trip title</label>
          <input
            name="title"
            value={form.title}
            onChange={onChange}
            placeholder="Summer in Italy"
            className="w-full h-10 px-3 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm outline-none focus:border-zinc-500"
          />
        </div>

        {/* Description */}
        <div className="space-y-1">
          <label className="text-xs text-zinc-500">Description</label>
          <textarea
            name="description"
            value={form.description}
            onChange={onChange}
            rows={3}
            placeholder="Optional"
            className="w-full px-3 py-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm resize-none outline-none focus:border-zinc-500"
          />
        </div>

        {/* Dates */}
        <div className="grid grid-cols-2 gap-3">
          <div className="space-y-1">
            <label className="text-xs text-zinc-500">Start date</label>
            <input
              type="date"
              name="startDate"
              value={form.startDate}
              onChange={onChange}
              className="w-full h-10 px-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm"
            />
          </div>

          <div className="space-y-1">
            <label className="text-xs text-zinc-500">End date</label>
            <input
              type="date"
              name="endDate"
              value={form.endDate}
              onChange={onChange}
              className="w-full h-10 px-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm"
            />
          </div>
        </div>
      </div>

      {/* MOBILE BOTTOM CTA */}
      <div className="md:hidden fixed bottom-0 inset-x-0 bg-white/90 dark:bg-black/90 backdrop-blur border-t border-zinc-200 dark:border-zinc-800 px-4 py-3">
        <button
          onClick={submit}
          disabled={loading}
          className="w-full h-11 rounded-md bg-sky-500 text-white font-semibold text-sm disabled:opacity-40"
        >
          {loading ? "Creating..." : "Continue"}
        </button>
      </div>
    </div>
  );
};

export default Planning;
import React, { useEffect, useMemo, useState } from "react";
import { useNavigate, useOutletContext } from "react-router-dom";
import { Axios } from "../../../lib/axios-config";
import toast from "react-hot-toast";
import DaySelector from "./day-selector";
import DayPlanningControls from "./day-planning-control";
import { Loader } from "../../components";
import { DayActions } from "../components/day-action";
import { ActivityGrid } from "../components/activity-grid";
import { ActivityTabs } from "../components/activity-tabs";
import { HotelSection } from "../components/hotel-section";
import { CitySelector } from "../components/city-selector";
import { DayHeader } from "../components/day-header";
import type { IActivity, ITripDayLocal } from "../trip.types";

const DayPlanning: React.FC = () => {
  const navigate = useNavigate();
  const { tripData, setCompleted } = useOutletContext<any>();
  const { tripId, startDate, endDate, countryId } = tripData || {};

  const [tripDays, setTripDays] = useState<ITripDayLocal[]>([]);
  const [selectedIndex, setSelectedIndex] = useState(0);
  const [allCities, setAllCities] = useState<{ _id: string; name: string }[]>(
    []
  );
  const [hotels, setHotels] = useState<IActivity[]>([]);
  const [activities, setActivities] = useState<{
    day: IActivity[];
    night: IActivity[];
    cafe: IActivity[];
  }>({ day: [], night: [], cafe: [] });
  const [loading, setLoading] = useState(false);
  const [saving, setSaving] = useState(false);
  const [hotelSearch, setHotelSearch] = useState("");
  const [minStars, setMinStars] = useState(0);
  const [activeTab, setActiveTab] = useState<"day" | "night" | "cafe">("day");

  const selectedDay = tripDays[selectedIndex];

  const selectedHotel = useMemo(() => {
    if (!selectedDay?.hotelId) return null;
    return hotels.find((h) => h.id === selectedDay.hotelId) || null;
  }, [hotels, selectedDay?.hotelId]);

  // === Օրերի ստեղծում ===
  useEffect(() => {
    if (!startDate || !endDate || !tripId) return;
    const start = new Date(startDate);
    const end = new Date(endDate);
    const days: ITripDayLocal[] = [];
    let current = new Date(start);
    while (current <= end) {
      days.push({
        day: days.length + 1,
        date: current.toISOString().slice(0, 10),
        cityId: null,
        hotelId: null,
        tripDayId: null,
        dayActivities: [],
        nightActivities: [],
        cafes: [],
      });
      current.setDate(current.getDate() + 1);
    }
    setTripDays(days);
  }, [startDate, endDate, tripId]);

  // === Քաղաքների բեռնում ===
  useEffect(() => {
    if (!countryId) return;
    Axios.get(`/city/all/${countryId}`)
      .then((res) => setAllCities(res.data.payload || []))
      .catch(() => toast.error("Չհաջողվեց բեռնել քաղաքները"));
  }, [countryId]);

  // === Մետատվյալների բեռնում ===
  useEffect(() => {
    if (!selectedDay?.cityId) {
      setHotels([]);
      setActivities({ day: [], night: [], cafe: [] });
      setHotelSearch("");
      setMinStars(0);
      return;
    }

    setLoading(true);
    const cityId = selectedDay.cityId;

    Promise.allSettled([
      Axios.get(`/metadata/hotels?id=${cityId}`),
      Axios.get(`/metadata/activities?id=${cityId}&type=day`),
      Axios.get(`/metadata/night-life?id=${cityId}`),
      Axios.get(`/metadata/activities?id=${cityId}&type=cafe`),
    ])
      .then((results) => {
        setHotels(
          results[0].status === "fulfilled"
            ? results[0].value.data.payload || []
            : []
        );
        setActivities({
          day:
            results[1].status === "fulfilled"
              ? results[1].value.data.payload || []
              : [],
          night:
            results[2].status === "fulfilled"
              ? results[2].value.data.payload || []
              : [],
          cafe:
            results[3].status === "fulfilled"
              ? results[3].value.data.payload || []
              : [],
        });
      })
      .catch(() => toast.error("Չհաջողվեց բեռնել տվյալները"))
      .finally(() => setLoading(false));
  }, [selectedDay?.cityId]);

  const filteredHotels = useMemo(() => {
    return hotels
      .filter(
        (h) =>
          h.name?.toLowerCase().includes(hotelSearch.toLowerCase()) &&
          (h.stars || 0) >= minStars
      )
      .sort((a, b) => (b.stars || 0) - (a.stars || 0));
  }, [hotels, hotelSearch, minStars]);

  const handleCityChange = (cityId: string) => {
    setTripDays((prev) =>
      prev.map((d, i) =>
        i === selectedIndex
          ? {
              ...d,
              cityId,
              hotelId: null,
              dayActivities: [],
              nightActivities: [],
              cafes: [],
            }
          : d
      )
    );
  };

  const handleHotelSelect = (hotelId: string | null) => {
    setTripDays((prev) =>
      prev.map((d, i) =>
        i === selectedIndex ? { ...d, hotelId: hotelId || null } : d
      )
    );
  };

  const toggleActivity = (
    activity: IActivity,
    type: "day" | "night" | "cafe"
  ) => {
    setTripDays((prev) =>
      prev.map((d, i) => {
        if (i !== selectedIndex) return d;
        const key =
          type === "day"
            ? "dayActivities"
            : type === "night"
            ? "nightActivities"
            : "cafes";
        const exists = d[key].some((a: IActivity) => a.id === activity.id);
        return {
          ...d,
          [key]: exists
            ? d[key].filter((a: IActivity) => a.id !== activity.id)
            : [...d[key], activity],
        };
      })
    );
  };

  const saveCurrentDay = async () => {
    if (!selectedDay?.cityId) return toast.error("Ընտրեք քաղաք");
    setSaving(true);
    toast.loading("Պահպանվում է օրը...", { id: "save" });

    try {
      const tripDayRes = await Axios.post("/trip-day", {
        tripId,
        order: selectedDay.day,
        cityId: selectedDay.cityId,
        hotelId: selectedDay.hotelId || null,
      });

      const tripDayId = tripDayRes.data.payload._id;
      setTripDays((prev) =>
        prev.map((d, i) => (i === selectedIndex ? { ...d, tripDayId } : d))
      );

      const promises = [];
      for (const act of [...selectedDay.dayActivities, ...selectedDay.cafes]) {
        promises.push(
          Axios.post("/activity", {
            tripDayId,
            cityId: selectedDay.cityId,
            activityId: act.id,
          }).catch(() => {})
        );
      }
      for (const act of selectedDay.nightActivities) {
        promises.push(
          Axios.post("/activity/night", {
            tripDayId,
            cityId: selectedDay.cityId,
            nightActivityId: act.id,
          }).catch(() => {})
        );
      }

      if (promises.length > 0) await Promise.all(promises);

      toast.success("Օրը հաջողությամբ պահպանվեց!", { id: "save" });

      if (selectedIndex < tripDays.length - 1) {
        setSelectedIndex((i) => i + 1);
      } else {
        setCompleted({ dayPlanning: true });
        navigate("/trips/new/finish");
        toast.success("Ամբողջ ճանապարհորդությունը պատրաստ է");
      }
    } catch (err: any) {
      toast.error(err.response?.data?.message || "Չհաջողվեց պահպանել", {
        id: "save",
      });
    } finally {
      setSaving(false);
    }
  };

  const skipAll = () => {
    setCompleted({ dayPlanning: true });
    navigate("/trips/new/finish");
  };

  const currentActivities = activities[activeTab];
  const selectedActivities =
    activeTab === "day"
      ? selectedDay?.dayActivities || []
      : activeTab === "night"
      ? selectedDay?.nightActivities || []
      : selectedDay?.cafes || [];
  const counts = {
    day: selectedDay?.dayActivities.length || 0,
    night: selectedDay?.nightActivities.length || 0,
    cafe: selectedDay?.cafes.length || 0,
  };
  const toggleCurrentActivity = (activity: IActivity) =>
    toggleActivity(activity, activeTab);

  return (
    <div className="min-h-screen bg-black text-white">
      <div className="max-w-7xl mx-auto px-4 pb-32 sm:pb-12 space-y-8">
        {/* Desktop top controls */}
        <div className="hidden sm:block">
          <DayPlanningControls onSkip={skipAll} onFinish={skipAll} />
        </div>

        {/* Day selector */}
        <DaySelector
          tripDays={tripDays}
          selectedIndex={selectedIndex}
          setSelectedIndex={setSelectedIndex}
        />

        {selectedDay && (
          <div className="space-y-8">
            {/* Day header */}
            <div className="rounded-2xl bg-white/5 border border-white/10 p-4 sm:p-6">
              <DayHeader day={selectedDay.day} date={selectedDay.date} />
            </div>

            {/* City selector */}
            <div className="rounded-2xl bg-white/5 border border-white/10 p-4 sm:p-6">
              <CitySelector
                cities={allCities}
                selectedCityId={selectedDay.cityId}
                onChange={handleCityChange}
              />
            </div>

            {selectedDay.cityId && (
              <>
                {/* Hotel section */}
                <div className="rounded-2xl bg-white/5 border border-white/10 p-4 sm:p-6">
                  <HotelSection
                    hotels={hotels}
                    selectedHotel={selectedHotel}
                    hotelSearch={hotelSearch}
                    minStars={minStars}
                    onHotelSearch={setHotelSearch}
                    onMinStarsChange={setMinStars}
                    onHotelSelect={handleHotelSelect}
                    loading={loading}
                  />
                </div>

                {/* Activities */}
                <div className="rounded-2xl bg-white/5 border border-white/10 p-4 sm:p-6 space-y-6">
                  <ActivityTabs
                    activeTab={activeTab}
                    onTabChange={setActiveTab}
                    counts={counts}
                  />
                  <ActivityGrid
                    activities={currentActivities}
                    selectedActivities={selectedActivities}
                    onToggle={toggleCurrentActivity}
                  />
                </div>

                {/* Desktop actions */}
                <div className="hidden sm:block">
                  <DayActions
                    canCopyFromPrevious={
                      selectedIndex > 0 && !!tripDays[selectedIndex - 1].cityId
                    }
                    onCopyFromPrevious={() => {
                      const prev = tripDays[selectedIndex - 1];
                      setTripDays((d) =>
                        d.map((x, i) =>
                          i === selectedIndex
                            ? {
                                ...x,
                                cityId: prev.cityId,
                                hotelId: prev.hotelId,
                              }
                            : x
                        )
                      );
                    }}
                    saving={saving}
                    hasCity={!!selectedDay.cityId}
                    onSave={saveCurrentDay}
                    onSkipAll={skipAll}
                  />
                </div>
              </>
            )}
          </div>
        )}
      </div>

      {/* Mobile bottom bar (Instagram-style) */}
      <div className="sm:hidden fixed bottom-0 left-0 right-0 z-50 bg-black/90 backdrop-blur-xl border-t border-white/10 px-4 py-3">
        <div className="flex gap-3">
          <button
            onClick={skipAll}
            className="flex-1 py-3 rounded-full bg-white/10 text-white text-sm font-medium"
          >
            Skip
          </button>
          <button
            onClick={saveCurrentDay}
            disabled={saving}
            className="flex-[1.5] py-3 rounded-full bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm font-semibold disabled:opacity-50"
          >
            {selectedIndex < tripDays.length - 1 ? "Save day" : "Finish trip"}
          </button>
        </div>
      </div>
    </div>
  );
};

export default DayPlanning;
import React from "react";

interface DayPlanningControlsProps {
  onSkip: () => void;
  onFinish: () => void;
}

const DayPlanningControls: React.FC<DayPlanningControlsProps> = ({
  onSkip,
  onFinish,
}) => {
  return (
    <>
      {/* DESKTOP / TABLET */}
      <div className="hidden sm:flex items-center justify-between mb-8">
        <h1 className="text-2xl font-semibold text-white tracking-tight">
          Plan Your Trip Days
        </h1>

        <div className="flex gap-3">
          <button
            onClick={onSkip}
            className="
              px-5 py-2.5 rounded-full
              bg-white/5 border border-white/10
              text-white text-sm
              hover:bg-white/10
              transition
            "
          >
            Skip
          </button>

          <button
            onClick={onFinish}
            className="
              px-6 py-2.5 rounded-full
              bg-blue-600
              text-white text-sm font-medium
              hover:bg-blue-500
              transition
            "
          >
            Finish
          </button>
        </div>
      </div>

      {/* MOBILE – INSTAGRAM STYLE BOTTOM BAR */}
      <div
        className="
          sm:hidden
          fixed bottom-0 left-0 right-0 z-40
          bg-black/80 backdrop-blur-xl
          border-t border-white/10
          px-4 py-3
        "
      >
        <div className="flex items-center gap-3">
          <button
            onClick={onSkip}
            className="
              flex-1 py-3 rounded-xl
              bg-white/5
              text-white text-sm font-medium
              active:scale-[0.98]
              transition
            "
          >
            Skip
          </button>

          <button
            onClick={onFinish}
            className="
              flex-[1.5] py-3 rounded-xl
              bg-blue-600
              text-white text-sm font-semibold
              active:scale-[0.98]
              transition
            "
          >
            Finish
          </button>
        </div>
      </div>

      {/* MOBILE SAFE SPACE */}
      <div className="sm:hidden h-20" />
    </>
  );
};

export default DayPlanningControls;
// src/pages/ActivityList.tsx
import React, { useState } from "react";
import type { IActivity } from "../../../types";
import ActivityCard from "./activity-card";
import { Search } from "lucide-react";

interface ActivityListProps {
  title: string;
  activities: IActivity[];
  selectedActivities: IActivity[];
  onToggle: (activity: IActivity) => void;
  loading: boolean;
}

const ActivityList: React.FC<ActivityListProps> = ({
  title,
  activities,
  selectedActivities,
  onToggle,
  loading,
}) => {
  const [search, setSearch] = useState("");

  const filteredActivities = activities.filter((a) =>
    a.name.toLowerCase().includes(search.toLowerCase())
  );

  return (
    <section className="space-y-5 animate-fade-in">
      {/* TITLE */}
      {title && <h3 className="text-2xl font-semibold text-white">{title}</h3>}

      {/* SEARCH */}
      <div className="relative">
        <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-zinc-500" />
        <input
          type="text"
          value={search}
          onChange={(e) => setSearch(e.target.value)}
          placeholder="Search activities"
          className="
            w-full pl-12 pr-4 py-3
            rounded-full
            bg-white/5 border border-white/10
            text-white placeholder-zinc-500
            focus:outline-none focus:ring-2 focus:ring-blue-500
            transition shadow-sm
          "
        />
      </div>

      {/* LIST / GRID */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {filteredActivities.map((activity) => {
          const selected = selectedActivities.some((x) => x.id === activity.id);
          return (
            <div
              key={activity.id}
              className={`transition-transform duration-200 ease-in-out hover:scale-105 ${
                selected ? "border-2 border-blue-500 rounded-xl" : ""
              }`}
            >
              <ActivityCard
                activity={activity}
                selected={selected}
                onToggle={() => onToggle(activity)}
                disabled={loading}
              />
            </div>
          );
        })}
      </div>

      {/* EMPTY STATE */}
      {filteredActivities.length === 0 && (
        <div className="py-10 text-center text-zinc-500">
          No activities found
        </div>
      )}
    </section>
  );
};

export default ActivityList;
// src/pages/Hotel.tsx
import React, { useEffect, useState } from "react";
import { useNavigate, useOutletContext } from "react-router-dom";
import { Axios } from "../../../lib/axios-config";
import { Loader } from "../../components";
import { Star, ExternalLink, ChevronLeft } from "lucide-react";

export const Hotel: React.FC = () => {
  const navigate = useNavigate();
  const { tripData, setTripData } = useOutletContext<any>();

  const [hotels, setHotels] = useState<any[]>([]);
  const [loading, setLoading] = useState(false);
  const [selectedHotel, setSelectedHotel] = useState<string | null>(
    tripData?.hotelId || null
  );

  useEffect(() => {
    if (!tripData?.cityId) return;
    let mounted = true;

    (async () => {
      try {
        setLoading(true);
        const { data } = await Axios.get(
          `/metadata/hotels?id=${tripData.cityId}`
        );
        if (mounted) setHotels(data.payload || []);
      } finally {
        setLoading(false);
      }
    })();

    return () => {
      mounted = false;
    };
  }, [tripData?.cityId]);

  const next = () => {
    setTripData({ hotelId: selectedHotel });
    navigate("/trips/day-planning");
  };

  const skip = () => {
    setTripData({ hotelId: null });
    navigate("/trips/day-planning");
  };

  return (
    <div className="min-h-screen bg-white dark:bg-black">
      {/* HEADER */}
      <div className="sticky top-0 z-20 bg-white dark:bg-black border-b border-zinc-200 dark:border-zinc-800">
        <div className="h-12 px-3 flex items-center">
          <button onClick={() => navigate(-1)} className="p-2 -ml-2">
            <ChevronLeft />
          </button>
          <h1 className="flex-1 text-center text-sm font-semibold">
            Select hotel
          </h1>
          <button onClick={skip} className="text-sm text-zinc-500 font-medium">
            Skip
          </button>
        </div>
      </div>

      {/* CONTENT */}
      <div className="max-w-xl mx-auto px-3 py-4 space-y-4 pb-28">
        {loading && <Loader />}

        {hotels.map((hotel) => {
          const active = selectedHotel === hotel.id;

          return (
            <div
              key={hotel.id}
              onClick={() => setSelectedHotel(hotel.id)}
              className={`
                rounded-xl overflow-hidden cursor-pointer
                border transition
                ${
                  active
                    ? "border-sky-500"
                    : "border-zinc-200 dark:border-zinc-800"
                }
              `}
            >
              {/* IMAGE */}
              {hotel.images?.[0] && (
                <div className="relative">
                  <img
                    src={hotel.images[0]}
                    className="w-full h-44 object-cover"
                  />
                  {active && (
                    <div className="absolute inset-0 ring-2 ring-sky-500" />
                  )}
                </div>
              )}

              {/* INFO */}
              <div className="px-3 py-2">
                <div className="flex items-start justify-between gap-2">
                  <div>
                    <div className="text-sm font-medium">{hotel.name}</div>
                    <div className="text-xs text-zinc-500">{hotel.address}</div>
                  </div>

                  {hotel.website && (
                    <a
                      href={hotel.website}
                      target="_blank"
                      rel="noopener noreferrer"
                      onClick={(e) => e.stopPropagation()}
                      className="text-zinc-400 hover:text-zinc-600"
                    >
                      <ExternalLink className="w-4 h-4" />
                    </a>
                  )}
                </div>

                {hotel.stars > 0 && (
                  <div className="flex gap-0.5 mt-1">
                    {Array.from({ length: hotel.stars }).map((_, i) => (
                      <Star
                        key={i}
                        className="w-3.5 h-3.5 text-amber-400 fill-current"
                      />
                    ))}
                  </div>
                )}
              </div>
            </div>
          );
        })}
      </div>

      {/* MOBILE BOTTOM CTA */}
      <div className="md:hidden fixed bottom-0 inset-x-0 bg-white/90 dark:bg-black/90 backdrop-blur border-t border-zinc-200 dark:border-zinc-800 px-4 py-3">
        <button
          onClick={next}
          disabled={!selectedHotel}
          className="w-full h-11 rounded-md bg-sky-500 text-white font-semibold text-sm disabled:opacity-40"
        >
          Continue
        </button>
      </div>
    </div>
  );
};

export default Hotel;
import React, { useEffect, useState } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { Axios } from "../../lib/axios-config";
import toast from "react-hot-toast";
import { ChevronLeft } from "lucide-react";

const EditTrip: React.FC = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();

  const [form, setForm] = useState({
    title: "",
    description: "",
    startDate: "",
    endDate: "",
  });
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);

  useEffect(() => {
    if (!id) return;
    Axios.get(`/trip/${id}`)
      .then(({ data }) => {
        const trip = data.payload;
        setForm({
          title: trip.title,
          description: trip.description,
          startDate: trip.startDate.slice(0, 10),
          endDate: trip.endDate.slice(0, 10),
        });
      })
      .catch(() => toast.error("Failed to load trip"))
      .finally(() => setLoading(false));
  }, [id]);

  const onChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => setForm((p) => ({ ...p, [e.target.name]: e.target.value }));

  const submit = async () => {
    try {
      setSaving(true);
      await Axios.put(`/trip/${id}`, form);
      toast.success("Trip updated");
      navigate(-1);
    } catch {
      toast.error("Failed to update trip");
    } finally {
      setSaving(false);
    }
  };

  if (loading) return null;

  return (
    <div className="min-h-screen bg-white dark:bg-black">
      {/* Header */}
      <div className="sticky top-0 z-20 bg-white dark:bg-black border-b border-zinc-200 dark:border-zinc-800">
        <div className="h-12 px-3 flex items-center">
          <button onClick={() => navigate(-1)} className="p-2 -ml-2">
            <ChevronLeft />
          </button>
          <h1 className="flex-1 text-center text-sm font-semibold">
            Edit trip
          </h1>
          <button
            onClick={submit}
            disabled={saving}
            className="text-sm font-semibold text-sky-500 disabled:opacity-50"
          >
            Save
          </button>
        </div>
      </div>

      {/* Content */}
      <div className="max-w-xl mx-auto px-4 py-6 space-y-6">
        {/* Title */}
        <div className="space-y-1">
          <label className="text-xs text-zinc-500">Title</label>
          <input
            name="title"
            value={form.title}
            onChange={onChange}
            className="w-full h-10 px-3 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm outline-none focus:border-zinc-500"
          />
        </div>

        {/* Description */}
        <div className="space-y-1">
          <label className="text-xs text-zinc-500">Description</label>
          <textarea
            name="description"
            rows={3}
            value={form.description}
            onChange={onChange}
            className="w-full px-3 py-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm resize-none outline-none focus:border-zinc-500"
          />
        </div>

        {/* Dates */}
        <div className="grid grid-cols-2 gap-3">
          <div className="space-y-1">
            <label className="text-xs text-zinc-500">Start date</label>
            <input
              type="date"
              name="startDate"
              value={form.startDate}
              onChange={onChange}
              className="w-full h-10 px-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm"
            />
          </div>

          <div className="space-y-1">
            <label className="text-xs text-zinc-500">End date</label>
            <input
              type="date"
              name="endDate"
              value={form.endDate}
              onChange={onChange}
              className="w-full h-10 px-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900 text-sm"
            />
          </div>
        </div>
      </div>
    </div>
  );
};

export default EditTrip;
import React from "react";

interface DayHeaderProps {
  day: number;
  date: string;
}

export const DayHeader: React.FC<DayHeaderProps> = ({ day, date }) => (
  <div className="bg-gradient-to-r from-indigo-600/30 via-purple-600/30 to-pink-600/30 p-8 sm:p-12 text-center rounded-3xl shadow-lg">
    <h1 className="text-4xl sm:text-6xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300 drop-shadow-md">
      Օր {day}
    </h1>
    <p className="text-lg sm:text-2xl text-zinc-300 mt-2 sm:mt-4">{date}</p>
  </div>
);
import React from "react";
import ActivityCard from "../steps/activity-card";
import type { HotelSectionProps } from "../trip.types";

export const HotelSection: React.FC<HotelSectionProps> = ({
  hotels,
  selectedHotel,
  hotelSearch,
  minStars,
  onHotelSearch,
  onMinStarsChange,
  onHotelSelect,
  loading,
}) => {
  const filteredHotels = hotels
    .filter(
      (h) =>
        h.name?.toLowerCase().includes(hotelSearch.toLowerCase()) &&
        (h.stars || 0) >= minStars
    )
    .sort((a, b) => (b.stars || 0) - (a.stars || 0));

  if (loading) return null;

  return (
    <div className="space-y-10">
      <h2 className="text-3xl sm:text-4xl font-extrabold text-center bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400">
        Հյուրանոց
      </h2>

      {!selectedHotel ? (
        <>
          {/* Search & Filter */}
          <div className="max-w-2xl mx-auto flex flex-col sm:flex-row gap-4 sm:gap-6 justify-center items-center">
            <input
              type="text"
              placeholder="Որոնել հյուրանոց..."
              value={hotelSearch}
              onChange={(e) => onHotelSearch(e.target.value)}
              className="w-full sm:w-auto px-4 sm:px-6 py-3 sm:py-4 rounded-2xl bg-zinc-800/90 border border-zinc-700 text-white placeholder-zinc-400 focus:ring-4 focus:ring-indigo-500 transition-shadow shadow-inner"
            />
            <div className="flex items-center gap-3">
              <span className="text-zinc-400 text-sm sm:text-base">
                Մին. աստղեր:
              </span>
              <input
                type="range"
                min="0"
                max="5"
                step="1"
                value={minStars}
                onChange={(e) => onMinStarsChange(Number(e.target.value))}
                className="w-24 sm:w-32 accent-indigo-500"
              />
              <span className="text-white font-semibold text-lg w-8 text-center">
                {minStars || "-"}
              </span>
            </div>
          </div>

          {/* Hotel Grid */}
          {filteredHotels.length === 0 ? (
            <p className="text-center text-zinc-500 py-10">
              Հյուրանոցներ չեն գտնվել
            </p>
          ) : (
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-8 p-2 sm:p-4">
              {filteredHotels.map((hotel) => (
                <div
                  key={hotel.id}
                  className="transition-transform transform hover:scale-105"
                >
                  <ActivityCard
                    activity={hotel}
                    selected={false}
                    onClick={() => onHotelSelect(hotel.id)}
                    isHotel={true}
                  />
                </div>
              ))}
            </div>
          )}
        </>
      ) : (
        // Selected Hotel View
        <div className="max-w-2xl mx-auto space-y-6">
          <ActivityCard
            activity={selectedHotel}
            selected={true}
            onClick={() => {}}
            disabled
            isHotel={true}
          />
          <div className="text-center">
            <button
              onClick={() => onHotelSelect(null)}
              className="px-8 sm:px-10 py-3 sm:py-4 rounded-2xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-600 transition text-lg sm:text-xl font-semibold"
            >
              Փոխել հյուրանոցը
            </button>
          </div>
        </div>
      )}
    </div>
  );
};
import React from "react";
import type { DayActionsProps } from "../trip.types";

export const DayActions: React.FC<DayActionsProps> = ({
  canCopyFromPrevious,
  onCopyFromPrevious,
  saving,
  hasCity,
  onSave,
  onSkipAll,
}) => (
  <>
    <div className="flex flex-col sm:flex-row gap-4 sm:gap-8 justify-center items-center pt-8 sm:pt-12">
      <button
        onClick={onCopyFromPrevious}
        disabled={!canCopyFromPrevious}
        className="px-6 sm:px-10 py-3 sm:py-5 rounded-2xl border border-zinc-500 hover:bg-white/10 transition text-base sm:text-xl disabled:opacity-50 shadow-sm hover:shadow-md"
      >
        Պատճենել նախորդ օրվանից
      </button>

      <button
        onClick={onSave}
        disabled={saving || !hasCity}
        className="px-12 sm:px-20 py-4 sm:py-7 rounded-2xl bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-bold text-lg sm:text-2xl shadow-2xl disabled:opacity-50 transition flex items-center justify-center gap-3 sm:gap-4"
      >
        {saving ? "Պահպանվում է..." : "Պահպանել և շարունակել →"}
      </button>
    </div>

    <div className="text-center pt-6 sm:pt-8">
      <button
        onClick={onSkipAll}
        className="text-zinc-400 hover:text-white text-base sm:text-lg underline transition-colors"
      >
        Բաց թողնել օրերի պլանավորումը
      </button>
    </div>
  </>
);
import React from "react";

interface ActivityTabsProps {
  activeTab: "day" | "night" | "cafe";
  onTabChange: (tab: "day" | "night" | "cafe") => void;
  counts: { day: number; night: number; cafe: number };
}

export const ActivityTabs: React.FC<ActivityTabsProps> = ({
  activeTab,
  onTabChange,
  counts,
}) => {
  const tabs = [
    { key: "day" as const, label: "Ցերեկային" },
    { key: "night" as const, label: "Գիշերային" },
    { key: "cafe" as const, label: "Ռեստորաններ" },
  ];

  return (
    <div className="flex justify-center gap-4 sm:gap-8 flex-wrap">
      {tabs.map((tab) => (
        <button
          key={tab.key}
          onClick={() => onTabChange(tab.key)}
          className={`relative px-6 sm:px-12 py-3 sm:py-6 rounded-2xl font-bold text-sm sm:text-xl transition-all duration-300 transform hover:scale-105
            ${
              activeTab === tab.key
                ? "bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-2xl"
                : "bg-zinc-800/80 text-zinc-400 hover:bg-zinc-700"
            }
          `}
        >
          {tab.label}
          {counts[tab.key] > 0 && (
            <span className="absolute -top-2 -right-2 sm:-top-3 sm:-right-3 bg-emerald-500 text-white text-xs sm:text-sm rounded-full w-6 h-6 sm:w-8 sm:h-8 flex items-center justify-center font-bold shadow-md">
              {counts[tab.key]}
            </span>
          )}
        </button>
      ))}
    </div>
  );
};
import React from "react";

interface CitySelectorProps {
  cities: { _id: string; name: string }[];
  selectedCityId: string | null;
  onChange: (cityId: string) => void;
}

export const CitySelector: React.FC<CitySelectorProps> = ({
  cities,
  selectedCityId,
  onChange,
}) => (
  <div className="max-w-md mx-auto">
    <label className="text-lg sm:text-xl font-semibold text-zinc-300 mb-2 block">
      Քաղաք
    </label>
    <div className="relative">
      <select
        value={selectedCityId || ""}
        onChange={(e) => onChange(e.target.value)}
        className="appearance-none w-full px-4 sm:px-6 py-3 sm:py-4 rounded-2xl bg-zinc-800/90 border border-zinc-700 text-lg sm:text-xl text-white focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:border-indigo-400 transition-all shadow-md cursor-pointer"
      >
        <option value="">Ընտրել քաղաք...</option>
        {cities.map((c) => (
          <option key={c._id} value={c._id}>
            {c.name}
          </option>
        ))}
      </select>
      {/* Arrow icon */}
      <span className="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-white">
        ▼
      </span>
    </div>
  </div>
);
import React from "react";
import ActivityCard from "../steps/activity-card";
import type { ActivityGridProps } from "../trip.types";

export const ActivityGrid: React.FC<ActivityGridProps> = ({
  activities,
  selectedActivities,
  onToggle,
}) => (
  <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 sm:gap-4 p-2 sm:p-4">
    {activities.map((a) => (
      <div
        key={a.id}
        className={`relative group rounded-xl overflow-hidden cursor-pointer transition-transform transform hover:scale-105`}
        onClick={() => onToggle(a)}
      >
        <ActivityCard
          onClick={() => onToggle(a)}
          activity={a}
          selected={selectedActivities.some((x) => x.id === a.id)}
          isHotel={false}
        />
        {selectedActivities.some((x) => x.id === a.id) && (
          <div className="absolute inset-0 bg-black/30 flex items-center justify-center">
            <span className="text-white text-xl font-bold">✓</span>
          </div>
        )}
      </div>
    ))}
  </div>
);
import React, { useEffect, useRef, useState } from "react";
import { Axios } from "../../lib/axios-config";
import { useNavigate } from "react-router-dom";
import { Loader } from "../components";
import {
  Edit,
  Trash2,
  Copy,
  CheckCircle,
  Eye,
  Lock,
  Unlock,
} from "lucide-react";
import toast from "react-hot-toast";
import dayjs from "dayjs";

interface Trip {
  _id: string;
  title: string;
  description: string;
  startDate: string;
  endDate: string;
  isPrivate: boolean;
  isCompleted?: boolean;
  coverImage?: string;
  dayCount: number;
}

const MyTrips: React.FC = () => {
  const navigate = useNavigate();
  const [trips, setTrips] = useState<Trip[]>([]);
  const [loading, setLoading] = useState(true);
  const [cloningId, setCloningId] = useState<string | null>(null);
  const [newStartDate, setNewStartDate] = useState("");
  const [newEndDate, setNewEndDate] = useState("");
  const app = useRef(import.meta.env.VITE_APP_DOMAIN);

  useEffect(() => {
    fetchTrips();
  }, []);

  const fetchTrips = async () => {
    try {
      setLoading(true);
      const { data } = await Axios.get("/trip");
      setTrips(data.payload || []);
    } catch {
      toast.error("Failed to load trips");
    } finally {
      setLoading(false);
    }
  };

  const deleteTrip = async (id: string) => {
    if (!window.confirm("Delete this trip?")) return;
    try {
      await Axios.delete(`/trip/${id}`);
      toast.success("Trip deleted");
      fetchTrips();
    } catch {
      toast.error("Failed to delete trip");
    }
  };

  const togglePrivate = async (id: string, current: boolean) => {
    try {
      await Axios.patch(`/trip/${id}`, { isPrivate: !current });
      fetchTrips();
    } catch {
      toast.error("Failed to update privacy");
    }
  };

  const toggleComplete = async (id: string, current: boolean) => {
    try {
      await Axios.patch(`/trip/${id}/complete`, { isCompleted: !current });
      fetchTrips();
    } catch {
      toast.error("Failed to update status");
    }
  };

  if (loading) return <Loader />;

  return (
    <div className="min-h-screen bg-white dark:bg-black px-4 py-6">
      <div className="max-w-5xl mx-auto">
        <h1 className="text-xl font-semibold mb-6">My Trips</h1>

        {trips.length === 0 ? (
          <p className="text-sm text-zinc-500 text-center">No trips yet</p>
        ) : (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {trips.map((trip) => (
              <div
                key={trip._id}
                className="border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden bg-white dark:bg-black"
              >
                {/* Cover */}
                {trip.coverImage && (
                  <img
                    src={app.current + trip.coverImage}
                    alt="cover"
                    className="w-full h-40 object-cover"
                  />
                )}

                {/* Content */}
                <div className="p-4 space-y-2">
                  <h2 className="font-medium truncate">{trip.title}</h2>

                  <p className="text-xs text-zinc-500 line-clamp-2">
                    {trip.description}
                  </p>

                  <p className="text-xs text-zinc-400">
                    {dayjs(trip.startDate).format("MMM D")} –{" "}
                    {dayjs(trip.endDate).format("MMM D")} · {trip.dayCount} days
                  </p>

                  {/* Status */}
                  <div className="flex items-center gap-2 text-xs text-zinc-500">
                    {trip.isPrivate ? <Lock size={14} /> : <Unlock size={14} />}
                    {trip.isCompleted && (
                      <CheckCircle size={14} className="text-emerald-500" />
                    )}
                  </div>

                  {/* Actions */}
                  <div className="flex items-center justify-between pt-2">
                    <div className="flex gap-3">
                      <button onClick={() => navigate(`/trips/${trip._id}`)}>
                        <Eye size={18} />
                      </button>
                      <button
                        onClick={() => navigate(`/trips/edit/${trip._id}`)}
                      >
                        <Edit size={18} />
                      </button>
                      <button onClick={() => setCloningId(trip._id)}>
                        <Copy size={18} />
                      </button>
                    </div>

                    <div className="flex gap-3">
                      <button
                        onClick={() =>
                          toggleComplete(trip._id, trip.isCompleted || false)
                        }
                      >
                        <CheckCircle size={18} />
                      </button>
                      <button
                        onClick={() => togglePrivate(trip._id, trip.isPrivate)}
                      >
                        {trip.isPrivate ? (
                          <Unlock size={18} />
                        ) : (
                          <Lock size={18} />
                        )}
                      </button>
                      <button onClick={() => deleteTrip(trip._id)}>
                        <Trash2 size={18} />
                      </button>
                    </div>
                  </div>

                  {/* Clone */}
                  {cloningId === trip._id && (
                    <div className="pt-3 space-y-2">
                      <input
                        type="date"
                        value={newStartDate}
                        onChange={(e) => setNewStartDate(e.target.value)}
                        className="w-full h-9 px-2 border rounded-md text-sm"
                      />
                      <input
                        type="date"
                        value={newEndDate}
                        onChange={(e) => setNewEndDate(e.target.value)}
                        className="w-full h-9 px-2 border rounded-md text-sm"
                      />
                      <button className="w-full h-9 bg-sky-500 text-white rounded-md text-sm">
                        Clone
                      </button>
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
};

export default MyTrips;
import type { ICountryCardProps } from "../../../types";
import { ImageCarousel } from "../image/image-carusel";

export const CountryCard: React.FC<ICountryCardProps> = ({ country, next }) => {
  if (!country) return null;

  const { name, description, images } = country;

  return (
    <div className="bg-white/10 dark:bg-slate-900/60 rounded-3xl overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col">
      {/* Image Carousel */}
      {images?.length > 0 && (
        <div className="w-full h-52 sm:h-56 relative">
          <ImageCarousel images={images} />
          <div className="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent" />
        </div>
      )}

      {/* Info */}
      <div className="p-4 flex flex-col gap-2 flex-1">
        <h3 className="text-lg font-semibold text-white line-clamp-1">
          {name}
        </h3>
        {description && (
          <p className="text-sm text-zinc-400 line-clamp-3">{description}</p>
        )}
      </div>

      {/* Action Button */}
      <button
        onClick={() => next(country._id)}
        className="w-full py-2 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-500 text-white font-medium rounded-b-3xl transition-colors shadow-sm"
      >
        Create Trip
      </button>
    </div>
  );
};
import type { ISidebarProps } from "../../../types";
import { NavLink } from "react-router-dom";

export function SidebarLink({ item, onClick }: ISidebarProps) {
  return (
    <NavLink
      to={item.to}
      onClick={onClick}
      end
      className={({ isActive }) =>
        [
          "flex items-center gap-4 px-4 py-3 rounded-lg text-sm font-medium transition",
          isActive
            ? "text-black dark:text-white font-semibold"
            : "text-zinc-500 hover:text-black dark:text-zinc-400 dark:hover:text-white",
        ].join(" ")
      }
    >
      <span className="text-lg">{item.icon}</span>
      <span className="truncate">{item.label}</span>
    </NavLink>
  );
}
interface EmptyStateProps {
  title: string;
  subtitle?: string;
  icon?: string;
}

export const EmptyState: React.FC<EmptyStateProps> = ({
  title,
  subtitle,
  icon,
}) => (
  <div className="flex flex-col items-center justify-center py-16 text-center text-zinc-500 dark:text-zinc-400">
    {icon && <span className="mb-3 text-3xl opacity-60">{icon}</span>}

    <p className="text-base font-medium">{title}</p>

    {subtitle && (
      <p className="mt-1 text-sm text-zinc-400 dark:text-zinc-500">
        {subtitle}
      </p>
    )}
  </div>
);
import type { Item } from "../../../types";
import {
  LayoutDashboard,
  Globe2,
  MapPin,
  Users,
  Globe,
  MapPinPlus,
} from "lucide-react";

export const navItems: Item[] = [
  {
    label: "Overview",
    to: "/admin",
    icon: <LayoutDashboard className="h-5 w-5" />,
  },
  {
    label: "Countries",
    to: "/admin/country",
    icon: <Globe2 className="h-5 w-5" />,
  },
  {
    label: "Cities",
    to: "/admin/city",
    icon: <MapPin className="h-5 w-5" />,
  },
  {
    label: "Users",
    to: "/admin/users",
    icon: <Users className="h-5 w-5" />,
  },
];
import React from "react";
import { Moon, Sun } from "lucide-react";
import { useTheme } from "../../../hooks/useThem";
const ThemeToggle: React.FC = () => {
  const { dark, toggle } = useTheme();

  return (
    <button
      onClick={toggle}
      className="p-3 rounded-xl bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition flex items-center gap-2"
    >
      {dark ? (
        <Sun size={20} className="text-yellow-500" />
      ) : (
        <Moon size={20} className="text-blue-600" />
      )}
      <span className="text-sm font-medium">{dark ? "Light" : "Dark"}</span>
    </button>
  );
};

export default ThemeToggle;
export const AdminCard = ({
  title,
  icon,
  children,
}: {
  title: string;
  icon?: string;
  children: React.ReactNode;
}) => (
  <section className="border border-zinc-200 dark:border-zinc-800 rounded-xl bg-white dark:bg-black">
    {/* Header */}
    <div className="flex items-center gap-2 px-4 py-3 border-b border-zinc-200 dark:border-zinc-800">
      {icon && <span className="text-zinc-500">{icon}</span>}
      <h2 className="text-sm font-semibold text-zinc-900 dark:text-zinc-100">
        {title}
      </h2>
    </div>

    {/* Content */}
    <div className="p-4">{children}</div>
  </section>
);
import { createPortal } from "react-dom";

export const MessagePopup = ({
  type,
  text,
}: {
  type: "success" | "error";
  text: string;
}) =>
  createPortal(
    <div className="fixed inset-x-0 top-4 z-[10000] flex justify-center pointer-events-none">
      <div
        className={[
          "px-4 py-2 rounded-lg text-xs sm:text-sm font-medium",
          "backdrop-blur bg-black/80 text-white",
          "animate-fade-in-down",
          type === "error" && "bg-rose-600/90",
        ]
          .filter(Boolean)
          .join(" ")}
      >
        {text}
      </div>
    </div>,
    document.body
  );
export const Loader = () => (
  <div className="fixed inset-0 z-[9999] flex items-center justify-center bg-white dark:bg-black">
    <div className="h-8 w-8 rounded-full border-2 border-zinc-300 dark:border-zinc-700 border-t-transparent animate-spin" />
  </div>
);
import React from "react";
import { Link, useLocation } from "react-router-dom";
import { Home, Globe, MapPin, User, Settings } from "lucide-react";

const MobileNav: React.FC = () => {
  const location = useLocation();

  const items = [
    { to: "/", icon: Home, label: "Home" },
    { to: "/trips/country", icon: Globe, label: "Plan" },
    { to: "/my-trips", icon: MapPin, label: "Trips" },
    { to: "/settings", icon: Settings, label: "Settings" },
    { to: "/profile", icon: User, label: "Profile" },
  ];

  return (
    <div className="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 md:hidden">
      <div className="flex justify-around py-2">
        {items.map((item) => {
          const Icon = item.icon;
          const active = location.pathname === item.to;
          return (
            <Link
              key={item.to}
              to={item.to}
              className={`flex flex-col items-center gap-1 px-4 py-2 rounded-xl transition ${
                active ? "text-blue-500" : "text-gray-600 dark:text-gray-400"
              }`}
            >
              <Icon size={24} />
              <span className="text-xs">{item.label}</span>
            </Link>
          );
        })}
      </div>
    </div>
  );
};

export default MobileNav;
import { ImagePlus, X } from "lucide-react";

interface UploadImagesProps {
  label?: string;
  previews: string[];
  disable?: boolean;
  onAdd: (e: React.ChangeEvent<HTMLInputElement>) => void;
  onDelete: (index: number) => void;
}

export const UploadImages: React.FC<UploadImagesProps> = ({
  label = "Upload Images",
  previews,
  onAdd,
  onDelete,
  disable,
}) => {
  return (
    <div className="space-y-3">
      <p className="text-sm font-medium text-zinc-700 dark:text-zinc-300">
        {label}
      </p>

      {/* Upload Area */}
      {!disable && (
        <label
          htmlFor="upload"
          className="
            flex flex-col items-center justify-center gap-3
            border-2 border-dashed border-zinc-300 dark:border-slate-700
            rounded-3xl p-5 sm:p-6 text-center cursor-pointer
            hover:border-pink-500 dark:hover:border-pink-400
            bg-white/70 dark:bg-slate-900/50
            transition-all duration-300 hover:shadow-lg
          "
        >
          <ImagePlus className="h-8 w-8 text-pink-500 dark:text-pink-400" />
          <p className="text-sm text-zinc-600 dark:text-zinc-400">
            Click or drag images to upload
          </p>
          <input
            id="upload"
            type="file"
            accept="image/*"
            multiple
            className="hidden"
            onChange={onAdd}
          />
        </label>
      )}

      {/* Previews Grid */}
      {previews.length > 0 && (
        <div className="grid grid-cols-3 sm:grid-cols-4 gap-2 mt-4">
          {previews.map((src, i) => (
            <div
              key={i}
              className="relative group overflow-hidden rounded-2xl shadow-sm hover:shadow-md transition"
            >
              <img
                src={src}
                alt={`Preview ${i}`}
                className="w-full h-24 sm:h-28 object-cover rounded-2xl group-hover:scale-105 transition-transform duration-300"
              />
              <button
                type="button"
                onClick={() => onDelete(i)}
                className="
                  absolute top-1 right-1 flex items-center justify-center
                  h-6 w-6 rounded-full bg-rose-500/80 hover:bg-rose-600
                  text-white shadow-md transition
                "
              >
                <X className="h-3.5 w-3.5" />
              </button>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};
import { Search } from "lucide-react";
import type { ISearchInputProps } from "../../../types";

export const SearchInput: React.FC<ISearchInputProps> = ({
  value,
  onChange,
  placeholder = "Search...",
  className = "",
}) => {
  return (
    <div className={`relative w-full ${className}`}>
      <Search className="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-zinc-400 dark:text-zinc-500" />
      <input
        type="text"
        value={value}
        onChange={(e) => onChange(e.target.value)}
        placeholder={placeholder}
        className="
          w-full pl-12 pr-4 py-2.5 rounded-full text-sm
          bg-white/90 dark:bg-slate-900/80
          border border-zinc-200 dark:border-slate-700
          text-zinc-800 dark:text-zinc-100
          placeholder:text-zinc-400 dark:placeholder:text-slate-500
          focus:outline-none focus:ring-2 focus:ring-sky-400/50 dark:focus:ring-teal-400/50
          shadow-sm hover:shadow-md transition-all duration-200
        "
      />
    </div>
  );
};
import type { ImageCarouselProps } from "../../../types";
import { ChevronLeft, ChevronRight, Trash2 } from "lucide-react";
import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";

export const ImageCarousel: React.FC<ImageCarouselProps> = ({
  images,
  title,
  isAdmin,
  onDeleteImage,
}) => {
  const [index, setIndex] = useState(0);

  const next = () => setIndex((index + 1) % images.length);
  const prev = () => setIndex((index - 1 + images.length) % images.length);

  if (!images?.length) return null;

  return (
    <div className="relative w-full overflow-hidden rounded-3xl border border-zinc-200 dark:border-slate-800 shadow-md">
      <AnimatePresence mode="wait">
        <motion.img
          key={images[index]}
          src={`${import.meta.env.VITE_APP_DOMAIN}${images[index]}`}
          alt={`${title || "Image"} ${index + 1}`}
          className="w-full aspect-[4/3] sm:aspect-[16/9] object-cover rounded-3xl"
          initial={{ opacity: 0, x: 50 }}
          animate={{ opacity: 1, x: 0 }}
          exit={{ opacity: 0, x: -50 }}
          transition={{ duration: 0.4 }}
          drag="x"
          dragConstraints={{ left: 0, right: 0 }}
          onDragEnd={(e, { offset, velocity }) => {
            if (offset.x < -50) next();
            else if (offset.x > 50) prev();
          }}
        />
      </AnimatePresence>

      {/* Overlay Title */}
      {title && (
        <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 via-transparent to-transparent p-3 text-white text-lg font-semibold tracking-tight rounded-b-3xl">
          {title}
        </div>
      )}

      {/* Admin Delete */}
      {isAdmin && onDeleteImage && images.length > 0 && (
        <button
          type="button"
          onClick={(e) => {
            e.preventDefault();
            e.stopPropagation();
            onDeleteImage(images[index]);
            prev();
          }}
          className="absolute top-3 right-3 bg-rose-500/70 hover:bg-rose-600/80 text-white rounded-full p-2 shadow-sm transition"
          aria-label="Delete image"
        >
          <Trash2 className="h-4 w-4" />
        </button>
      )}

      {/* Navigation Arrows */}
      {images.length > 1 && (
        <>
          <button
            onClick={(e) => {
              e.preventDefault();
              e.stopPropagation();
              prev();
            }}
            className="absolute left-2 top-1/2 -translate-y-1/2 bg-black/25 hover:bg-black/50 text-white rounded-full p-2 transition"
          >
            <ChevronLeft className="h-5 w-5" />
          </button>
          <button
            onClick={(e) => {
              e.preventDefault();
              e.stopPropagation();
              next();
            }}
            className="absolute right-2 top-1/2 -translate-y-1/2 bg-black/25 hover:bg-black/50 text-white rounded-full p-2 transition"
          >
            <ChevronRight className="h-5 w-5" />
          </button>
        </>
      )}

      {/* Dots */}
      {images.length > 1 && (
        <div className="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2">
          {images.map((_, i) => (
            <div
              key={i}
              onClick={() => setIndex(i)}
              className={`h-2.5 w-2.5 rounded-full cursor-pointer transition ${
                i === index
                  ? "bg-sky-400 dark:bg-teal-400"
                  : "bg-white/50 hover:bg-white/70"
              }`}
            />
          ))}
        </div>
      )}
    </div>
  );
};
import type { ImageSectionProps } from "../../../types";
import { motion, AnimatePresence } from "framer-motion";
import { useState } from "react";

export const ImageSection: React.FC<ImageSectionProps> = ({ images }) => {
  const [current, setCurrent] = useState(0);

  if (!images?.length) {
    return (
      <div className="h-44 sm:h-52 md:h-60 bg-gradient-to-br from-sky-100 to-teal-100 dark:from-slate-800 dark:to-slate-900 rounded-3xl flex items-center justify-center text-zinc-400 dark:text-slate-500 text-sm font-medium">
        No Images
      </div>
    );
  }

  const imgUrls = images.map(
    (img) => import.meta.env.VITE_APP_DOMAIN.toString() + img
  );

  const nextImage = () => setCurrent((prev) => (prev + 1) % imgUrls.length);
  const prevImage = () =>
    setCurrent((prev) => (prev - 1 + imgUrls.length) % imgUrls.length);

  return (
    <div className="relative w-full overflow-hidden rounded-3xl shadow-md">
      <AnimatePresence mode="wait">
        <motion.img
          key={imgUrls[current]}
          src={imgUrls[current]}
          alt={`Preview ${current + 1}`}
          className="h-44 sm:h-52 md:h-60 w-full object-cover rounded-3xl"
          initial={{ opacity: 0, x: 50 }}
          animate={{ opacity: 1, x: 0 }}
          exit={{ opacity: 0, x: -50 }}
          transition={{ duration: 0.5 }}
        />
      </AnimatePresence>

      <div className="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent rounded-3xl pointer-events-none" />

      {imgUrls.length > 1 && (
        <>
          <button
            onClick={prevImage}
            className="absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-black/30 hover:bg-black/50 rounded-full text-white"
          >
            ‹
          </button>
          <button
            onClick={nextImage}
            className="absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-black/30 hover:bg-black/50 rounded-full text-white"
          >
            ›
          </button>
        </>
      )}

      <div className="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1">
        {imgUrls.map((_, i) => (
          <span
            key={i}
            className={`h-1 w-1 rounded-full transition-all ${
              i === current ? "bg-white" : "bg-white/50"
            }`}
          />
        ))}
      </div>
    </div>
  );
};




  import type { ISearchInputProps } from "../../types";

export const SearchInput: React.FC<ISearchInputProps> = ({
  value,
  onChange,
  placeholder = "Type to search...",
  className = "",
}) => {
  return (
    <div className={`flex justify-center mb-8 ${className}`}>
      <div className="relative w-full sm:w-96">
        {/* 🔍 Search icon */}
        <svg
          xmlns="http://www.w3.org/2000/svg"
          className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M21 21l-4.35-4.35M17 10a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>

        <input
          type="text"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          placeholder={placeholder}
          className="
            w-full
            border border-gray-300 rounded-xl pl-10 pr-4 py-3
            shadow-sm bg-white text-gray-800
            focus:outline-none focus:ring-2 focus:ring-indigo-400
            transition duration-200
          "
        />
      </div>
    </div>
  );
};
import { Plus } from "lucide-react";

export const AddButton = ({
  onClick,
  label = "Add",
  className = "",
}: {
  onClick: () => void;
  label?: string;
  className?: string;
}) => {
  return (
    <button
      onClick={onClick}
      className={`
        inline-flex items-center justify-center sm:justify-start gap-2
        rounded-full px-3 py-2 text-sm font-medium
        bg-emerald-500/20 dark:bg-emerald-600/20
        text-white shadow-sm hover:shadow-md hover:bg-emerald-500/40
        transition ${className}
      `}
    >
      <Plus className="h-4 w-4" />
      <span className="hidden sm:inline">{label}</span>
    </button>
  );
};
import { Trash2 } from "lucide-react";

export const DeleteButton = ({
  id,
  onClick,
  label = "Delete",
}: {
  id: string;
  onClick?: (id: string) => void;
  label?: string;
}) => {
  return (
    <button
      onClick={() => onClick?.(id)}
      className="
        inline-flex items-center justify-center sm:justify-start gap-2
        rounded-full px-3 py-2 text-sm font-medium
        text-rose-500 border border-rose-500
        bg-rose-500/10 dark:bg-rose-500/20
        hover:bg-rose-500 hover:text-white transition
      "
    >
      <Trash2 className="h-4 w-4" />
      <span className="hidden sm:inline">{label}</span>
    </button>
  );
};
import { Pencil } from "lucide-react";
import { useNavigate } from "react-router-dom";

export const EditButton = ({
  onClick,
  to,
  label = "Edit",
}: {
  onClick?: () => void;
  to?: string;
  label?: string;
}) => {
  const navigate = useNavigate();

  return (
    <button
      onClick={() => (to ? navigate(to) : onClick?.())}
      className="
        inline-flex items-center justify-center sm:justify-start gap-2
        rounded-full px-3 py-2 text-sm font-medium
        bg-sky-500/20 dark:bg-sky-600/20
        text-sky-600 dark:text-sky-400
        hover:bg-sky-500/30 dark:hover:bg-sky-500/30
        transition
      "
    >
      <Pencil className="h-4 w-4" />
      <span className="hidden sm:inline">{label}</span>
    </button>
  );
};
import { ArrowLeft } from "lucide-react";
import { useNavigate } from "react-router-dom";

export const BackButton = ({
  to,
  label = "Back",
  className = "",
}: {
  to?: string;
  label?: string;
  className?: string;
}) => {
  const navigate = useNavigate();

  return (
    <button
      onClick={() => (to ? navigate(to) : navigate(-1))}
      className={`
        inline-flex items-center justify-center sm:justify-start gap-2
        rounded-full px-3 py-2 text-sm font-medium
        border border-zinc-300 dark:border-slate-700
        bg-zinc-100/10 dark:bg-slate-800/30
        hover:bg-zinc-100/30 dark:hover:bg-slate-800/60
        transition ${className}
      `}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="hidden sm:inline">{label}</span>
    </button>
  );
};
import { useForm } from "react-hook-form";
import { useState } from "react";
import { Axios } from "../../lib/axios-config";
import { MessagePopup } from "../components";
import { Eye, EyeOff } from "lucide-react";
import type { IResponse } from "../../types";

type FormValues = {
  oldPassword: string;
  newPassword: string;
};

export const UpdatePassword = () => {
  const {
    handleSubmit,
    register,
    reset,
    formState: { errors },
  } = useForm<FormValues>();
  const [loading, setLoading] = useState(false);
  const [popup, setPopup] = useState<{
    type: "success" | "error";
    text: string;
  } | null>(null);
  const [showOld, setShowOld] = useState(false);
  const [showNew, setShowNew] = useState(false);

  const showMessage = (type: "success" | "error", text: string) => {
    setPopup({ type, text });
    setTimeout(() => setPopup(null), 2500);
  };

  async function onSubmit(values: FormValues) {
    try {
      setLoading(true);
      const { data } = await Axios.post<IResponse>(
        "account/update-password",
        values
      );
      showMessage("success", (data as any).message || "Password updated");
      reset();
    } catch (err: any) {
      showMessage("error", err?.response?.data?.message || "Failed to update");
    } finally {
      setLoading(false);
    }
  }

  return (
    <div className="flex justify-center items-start min-h-screen p-6 bg-gradient-to-br from-pink-50 via-white to-sky-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950">
      <div className="w-full max-w-lg rounded-3xl p-8 bg-white/10 dark:bg-black/20 backdrop-blur-3xl shadow-xl animate-fade-in space-y-8 border border-white/10">
        {popup && <MessagePopup {...popup} />}

        <h2 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-sky-500 via-teal-400 to-emerald-400">
          Update Password
        </h2>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
          {/* Old Password */}
          <div className="space-y-1 relative">
            <label className="text-sm font-medium text-zinc-900 dark:text-white">
              Old Password
            </label>
            {errors.oldPassword && (
              <p className="text-red-500">{errors.oldPassword.message}</p>
            )}
            <div className="relative">
              <input
                type={showOld ? "text" : "password"}
                {...register("oldPassword", {
                  required: "Old password is required",
                  minLength: { value: 6, message: "At least 6 characters" },
                })}
                className="w-full px-3 py-2 pr-11 rounded-xl border border-white/20 dark:border-slate-700 bg-white/20 dark:bg-slate-800 text-zinc-900 dark:text-white placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-gradient-to-r focus:ring-sky-400 transition"
                placeholder="Enter old password"
              />
              <button
                type="button"
                onClick={() => setShowOld(!showOld)}
                className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition"
              >
                {showOld ? <EyeOff size={20} /> : <Eye size={20} />}
              </button>
            </div>
          </div>

          {/* New Password */}
          <div className="space-y-1 relative">
            <label className="text-sm font-medium text-zinc-900 dark:text-white">
              New Password
            </label>
            {errors.newPassword && (
              <p className="text-red-500">{errors.newPassword.message}</p>
            )}
            <div className="relative">
              <input
                type={showNew ? "text" : "password"}
                {...register("newPassword", {
                  required: "New password is required",
                  minLength: { value: 6, message: "At least 6 characters" },
                })}
                className="w-full px-3 py-2 pr-11 rounded-xl border border-white/20 dark:border-slate-700 bg-white/20 dark:bg-slate-800 text-zinc-900 dark:text-white placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-gradient-to-r focus:ring-teal-400 transition"
                placeholder="Enter new password"
              />
              <button
                type="button"
                onClick={() => setShowNew(!showNew)}
                className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition"
              >
                {showNew ? <EyeOff size={20} /> : <Eye size={20} />}
              </button>
            </div>
            <p className="text-xs text-zinc-500">Minimum 6 characters</p>
          </div>

          {/* Submit Button */}
          <button
            type="submit"
            disabled={loading}
            className={`w-full py-2 rounded-xl font-semibold bg-gradient-to-r from-emerald-400 to-sky-400 text-white hover:brightness-110 transition shadow-md ${
              loading ? "opacity-60 cursor-not-allowed" : ""
            }`}
          >
            {loading ? "Saving..." : "Save Changes"}
          </button>
        </form>
      </div>
    </div>
  );
};

export default UpdatePassword;
import { Outlet, useNavigate } from "react-router-dom";
import {
  ChevronLeft,
  LogOut,
  Wrench,
  ShieldCheck,
  Sun,
  Moon,
} from "lucide-react";
import { useTheme } from "../../hooks/useThem";
import type { IAccount } from "../../types";

export default function Settings() {
  const { dark, toggle } = useTheme();
  const navigate = useNavigate();

  const navItems = [
    {
      label: "Update password",
      to: "update-password",
      icon: <Wrench className="w-5 h-5" />,
    },
    {
      label: "Update username",
      to: "update-username",
      icon: <Wrench className="w-5 h-5" />,
    },
  ];

  const signOut = () => {
    localStorage.removeItem("Authorization");
    navigate("/");
  };

  return (
    <div className="min-h-screen bg-white dark:bg-black text-zinc-900 dark:text-white">
      {/* Mobile Header */}
      <div className="md:hidden sticky top-0 z-40 flex items-center h-14 border-b border-zinc-200 dark:border-zinc-800 px-4">
        <button onClick={() => navigate(-1)}>
          <ChevronLeft className="w-6 h-6" />
        </button>
        <h1 className="flex-1 text-center font-semibold">Settings</h1>
        <div className="w-6" />
      </div>

      {/* Content */}
      <div className="max-w-xl mx-auto px-4 py-6 space-y-6">
        {/* Navigation */}
        <div className="rounded-2xl overflow-hidden border border-zinc-200 dark:border-zinc-800">
          {navItems.map((item) => (
            <button
              key={item.label}
              onClick={() => navigate(item.to)}
              className="w-full flex items-center gap-4 px-4 py-4 text-left hover:bg-zinc-50 dark:hover:bg-zinc-900 transition border-b last:border-b-0 border-zinc-200 dark:border-zinc-800"
            >
              {item.icon}
              <span className="flex-1 text-sm font-medium">{item.label}</span>
              <ChevronLeft className="w-4 h-4 rotate-180 opacity-40" />
            </button>
          ))}

          {/* Theme toggle */}
          <button
            onClick={toggle}
            className="w-full flex items-center gap-4 px-4 py-4 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition"
          >
            {dark ? (
              <Sun className="w-5 h-5 text-yellow-400" />
            ) : (
              <Moon className="w-5 h-5 text-sky-500" />
            )}
            <span className="flex-1 text-sm font-medium">
              {dark ? "Light mode" : "Dark mode"}
            </span>
          </button>
        </div>

        {/* Sign out */}
        <button
          onClick={signOut}
          className="w-full flex items-center justify-center gap-2 py-3 rounded-xl text-sm font-semibold text-red-600 bg-red-500/10 hover:bg-red-500/20 transition"
        >
          <LogOut className="w-4 h-4" />
          Sign out
        </button>

        {/* Child routes (Profile, UpdatePassword, etc.) */}
        <Outlet />
      </div>
    </div>
  );
}
import { useForm } from "react-hook-form";
import { useState } from "react";
import { Axios } from "../../lib/axios-config";
import { MessagePopup } from "../components";
import { Eye, EyeOff } from "lucide-react";
import type { IResponse } from "../../types";

type FormValues = {
  username: string;
  password: string;
};

export const UpdateUsername = () => {
  const {
    handleSubmit,
    register,
    reset,
    formState: { errors },
  } = useForm<FormValues>();
  const [loading, setLoading] = useState(false);
  const [popup, setPopup] = useState<{
    type: "success" | "error";
    text: string;
  } | null>(null);
  const [show, setShow] = useState(false);

  const showMessage = (type: "success" | "error", text: string) => {
    setPopup({ type, text });
    setTimeout(() => setPopup(null), 2500);
  };

  async function onSubmit(values: FormValues) {
    try {
      setLoading(true);
      const { data } = await Axios.post<IResponse>(
        "account/update-username",
        values
      );
      showMessage("success", (data as any).message || "Username updated");
      reset();
    } catch (err: any) {
      showMessage("error", err?.response?.data?.message || "Failed to update");
    } finally {
      setLoading(false);
    }
  }

  return (
    <div className="flex justify-center items-start min-h-screen p-6 bg-gradient-to-br from-pink-50 via-white to-sky-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950">
      <div className="w-full max-w-lg rounded-3xl p-8 bg-white/10 dark:bg-black/20 backdrop-blur-3xl border border-white/10 shadow-xl animate-fade-in space-y-8">
        {popup && <MessagePopup {...popup} />}

        <h2 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-sky-500 via-teal-400 to-emerald-400">
          Update Username
        </h2>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
          {/* Username */}
          <div className="space-y-1 relative">
            <label className="text-sm font-medium text-zinc-900 dark:text-white">
              New Username
            </label>
            {errors.username && (
              <p className="text-red-500">{errors.username.message}</p>
            )}
            <input
              type="text"
              {...register("username", { required: "Username is required" })}
              className="w-full px-3 py-2 rounded-xl border border-white/20 dark:border-slate-700 bg-white/20 dark:bg-slate-800 text-zinc-900 dark:text-white placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-gradient-to-r focus:ring-sky-400 transition"
              placeholder="Enter new username"
            />
          </div>

          {/* Password */}
          <div className="space-y-1 relative">
            <label className="text-sm font-medium text-zinc-900 dark:text-white">
              Password
            </label>
            {errors.password && (
              <p className="text-red-500">{errors.password.message}</p>
            )}
            <div className="relative">
              <input
                type={show ? "text" : "password"}
                {...register("password", {
                  required: "Password is required",
                  minLength: { value: 6, message: "At least 6 characters" },
                })}
                className="w-full px-3 py-2 pr-11 rounded-xl border border-white/20 dark:border-slate-700 bg-white/20 dark:bg-slate-800 text-zinc-900 dark:text-white placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-gradient-to-r focus:ring-teal-400 transition"
                placeholder="Enter password"
              />
              <button
                type="button"
                onClick={() => setShow(!show)}
                className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition"
              >
                {show ? <EyeOff size={20} /> : <Eye size={20} />}
              </button>
            </div>
            <p className="text-xs text-zinc-500">Minimum 6 characters</p>
          </div>

          {/* Submit */}
          <button
            type="submit"
            disabled={loading}
            className={`w-full py-2 rounded-xl font-semibold bg-gradient-to-r from-emerald-400 to-sky-400 text-white hover:brightness-110 transition shadow-md ${
              loading ? "opacity-60 cursor-not-allowed" : ""
            }`}
          >
            {loading ? "Saving..." : "Save Changes"}
          </button>
        </form>
      </div>
    </div>
  );
};

export default UpdateUsername;
import { useEffect, useState } from "react";
import { Axios } from "../../lib/axios-config";
import type { IAccount, IResponse } from "../../types";

export default function Profile() {
  const [account, setAccount] = useState<IAccount | null>(null);

  useEffect(() => {
    Axios.get<IResponse<IAccount>>("account").then(({ data }) =>
      setAccount(data.payload)
    );
  }, []);

  if (!account) return null;

  return (
    <div className="max-w-md mx-auto bg-white dark:bg-zinc-900 rounded-2xl shadow-md overflow-hidden border border-zinc-200 dark:border-zinc-800 transition-colors">
      {/* Cover */}
      <div className="relative h-32 bg-gradient-to-r from-pink-400 via-purple-400 to-teal-400">
        <div className="absolute -bottom-10 left-1/2 -translate-x-1/2 w-20 h-20 rounded-full border-4 border-white dark:border-zinc-900 overflow-hidden shadow-lg">
          {account.avatar ? (
            <img
              src={account.avatar}
              alt={account.username}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full bg-zinc-200 dark:bg-zinc-800" />
          )}
        </div>
      </div>

      {/* Info */}
      <div className="mt-12 px-6 pb-6 text-center space-y-2">
        <h2 className="text-lg font-semibold text-zinc-900 dark:text-zinc-100">
          {account.username}
        </h2>
        <p className="text-sm text-zinc-500 dark:text-zinc-400">
          {account.email}
        </p>
      </div>

      {/* Details */}
      <div className="px-6 pb-6 space-y-2 text-sm">
        <div className="flex justify-between py-2 border-b border-zinc-200 dark:border-zinc-800">
          <span className="text-zinc-500 dark:text-zinc-400">Username</span>
          <span className="font-medium">{account.username}</span>
        </div>
        <div className="flex justify-between py-2 border-b border-zinc-200 dark:border-zinc-800">
          <span className="text-zinc-500 dark:text-zinc-400">Email</span>
          <span className="font-medium">{account.email}</span>
        </div>
        <div className="flex justify-between py-2">
          <span className="text-zinc-500 dark:text-zinc-400">Role</span>
          <span className="font-medium">{account.role}</span>
        </div>
      </div>
    </div>
  );
}
// src/pages/settings/settings-profile.tsx
import { useEffect, useState } from "react";
import { Axios } from "../../lib/axios-config";
import type { IAccount, IResponse } from "../../types";

export default function AccountCard() {
  const [account, setAccount] = useState<IAccount | null>(null);

  useEffect(() => {
    Axios.get<IResponse<IAccount>>("account").then(({ data }) =>
      setAccount(data.payload)
    );
  }, []);

  if (!account) return null;

  return (
    <div className="max-w-md mx-auto bg-white dark:bg-zinc-900 rounded-2xl shadow-md overflow-hidden border border-zinc-200 dark:border-zinc-800 transition-colors">
      {/* Cover */}
      <div className="relative h-32 bg-gradient-to-r from-pink-400 via-purple-400 to-teal-400">
        <div className="absolute -bottom-10 left-1/2 -translate-x-1/2 w-20 h-20 rounded-full border-4 border-white dark:border-zinc-900 overflow-hidden shadow-lg">
          {account.avatar ? (
            <img
              src={account.avatar}
              alt={account.username}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full bg-zinc-200 dark:bg-zinc-800" />
          )}
        </div>
      </div>

      {/* Info */}
      <div className="mt-12 px-6 pb-6 text-center space-y-2">
        <h2 className="text-lg font-semibold text-zinc-900 dark:text-zinc-100">
          {account.username}
        </h2>
        <p className="text-sm text-zinc-500 dark:text-zinc-400">
          {account.email}
        </p>
      </div>

      {/* Details */}
      <div className="px-6 pb-6 space-y-2 text-sm">
        <div className="flex justify-between py-2 border-b border-zinc-200 dark:border-zinc-800">
          <span className="text-zinc-500 dark:text-zinc-400">Username</span>
          <span className="font-medium">{account.username}</span>
        </div>
        <div className="flex justify-between py-2 border-b border-zinc-200 dark:border-zinc-800">
          <span className="text-zinc-500 dark:text-zinc-400">Email</span>
          <span className="font-medium">{account.email}</span>
        </div>
        <div className="flex justify-between py-2">
          <span className="text-zinc-500 dark:text-zinc-400">Role</span>
          <span className="font-medium">{account.role}</span>
        </div>
      </div>
    </div>
  );
}
import { createContext, useContext, useEffect, useState } from "react";

type ThemeContextType = {
  dark: boolean;
  toggle: () => void;
};

const ThemeContext = createContext<ThemeContextType>({
  dark: false,
  toggle: () => {},
});

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [dark, setDark] = useState(() => {
    if (typeof window === "undefined") return false;
    const saved = localStorage.getItem("theme");
    if (saved) return saved === "dark";
    return window.matchMedia("(prefers-color-scheme: dark)").matches;
  });

  useEffect(() => {
    const root = document.documentElement;
    if (dark) {
      root.classList.add("dark");
      localStorage.setItem("theme", "dark");
    } else {
      root.classList.remove("dark");
      localStorage.setItem("theme", "light");
    }
  }, [dark]);

  const toggle = () => setDark((prev) => !prev);

  return (
    <ThemeContext.Provider value={{ dark, toggle }}>
      {children}
    </ThemeContext.Provider>
  );
}

export const useTheme = () => useContext(ThemeContext);
